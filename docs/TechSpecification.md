ТЕХНИЧЕСКОЕ ЗАДАНИЕ: Игра Catan (Колонизаторы)
РАЗДЕЛ 1: ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

BEGIN_TZ_SECTION_FR-GAME-INIT: Инициализация игры
START_LOGIC_BLOCK_BOARD_GENERATION
Назначение: Генерация игрового поля с гексами, числовыми жетонами и портами. Требование: Система должна создавать стандартное игровое поле из 19 гексов с корректным распределением ресурсов и числовых жетонов. AAG:
[Создание структуры гексов]: Система (Инициализация игры) -> Создает 19 гексов в форме шестиугольника -> Распределяет типы ресурсов:
  - 4 гекса леса (дерево)
  - 4 гекса полей (зерно)
  - 4 гекса пастбищ (шерсть)
  - 3 гекса гор (руда)
  - 3 гекса холмов (глина)
  - 1 гекс пустыни
-> Каждый гекс имеет уникальный идентификатор и координаты.
Предположение: Расположение гексов соответствует стандартной конфигурации Catan.
Риск: Низкий.

[Размещение числовых жетонов]: Система (После создания гексов) -> Распределяет жетоны с числами 2-12 на гексы (кроме пустыни):
  - 1 жетон с числом 2
  - 2 жетона с числом 3
  - 2 жетона с числом 4
  - 2 жетона с числом 5
  - 2 жетона с числом 6
  - 2 жетона с числом 8
  - 2 жетона с числом 9
  - 2 жетона с числом 10
  - 2 жетона с числом 11
  - 1 жетон с числом 12
-> Жетоны размещаются согласно стандартной спиральной раскладке или случайно (но сбалансированно).
Предположение: Числа 6 и 8 (наиболее вероятные) не должны быть на соседних гексах в сбалансированной генерации.
Риск: Средний - несбалансированное размещение может нарушить игровой баланс.

[Расчет вероятностей выпадения]: Система (После размещения жетонов) -> Для каждого гекса вычисляет вероятность выпадения числа:
  - 2 или 12: вероятность 1/36
  - 3 или 11: вероятность 2/36
  - 4 или 10: вероятность 3/36
  - 5 или 9: вероятность 4/36
  - 6 или 8: вероятность 5/36
-> Сохраняет вероятности для использования в логике ИИ.
Предположение: Вероятности используются для оценки ценности позиций.
Риск: Низкий.
Ключевые слова: [board-generation, hex-tiles, resource-distribution, number-tokens, probability-calculation] 
END_LOGIC_BLOCK_BOARD_GENERATION

START_LOGIC_BLOCK_PORT_PLACEMENT
Назначение: Размещение портов на краях игрового поля. Требование: Система должна разместить 9 портов (4 общих и 5 специализированных) на границах игрового поля. AAG:
[Размещение портов]: Система (После генерации гексов) -> Размещает 9 портов на ребрах, граничащих с водой (вне основного шестиугольника):
  - 4 общих порта (3:1 для любого ресурса)
  - 5 специализированных портов (2:1 для конкретного ресурса):
    * 1 порт дерева
    * 1 порт глины
    * 1 порт шерсти
    * 1 порт зерна
    * 1 порт руды
-> Каждый порт связан с 2 перекрестками (вершинами гексов).
Предположение: Порты размещены на стандартных позициях согласно оригинальной игре.
Риск: Низкий.

[Связывание портов с перекрестками]: Система -> Для каждого порта сохраняет идентификаторы 2 смежных перекрестков -> При размещении поселения/города на этих перекрестках игрок получает доступ к торговому курсу порта.
Предположение: Один перекресток может быть связан только с одним портом.
Риск: Низкий.
Ключевые слова: [ports, trade-ratios, port-placement, general-ports, specialized-ports] END_LOGIC_BLOCK_PORT_PLACEMENT
START_LOGIC_BLOCK_ROBBER_INIT
Назначение: Инициализация разбойника на пустыне. Требование: Разбойник должен быть размещен на гексе пустыни в начале игры. AAG:
[Размещение разбойника]: Система (После генерации поля) -> Находит гекс пустыни -> Размещает разбойника на этом гексе -> Сохраняет текущую позицию разбойника в состоянии игры.
Предположение: Гекс с разбойником не дает ресурсы при выпадении его числа (но у пустыни нет числа).
Риск: Низкий.
Ключевые слова: [robber, initialization, desert-hex] END_LOGIC_BLOCK_ROBBER_INIT
START_LOGIC_BLOCK_GRAPH_STRUCTURE
Назначение: Построение графовой структуры поля для навигации и валидации. Требование: Система должна создать граф из вершин (перекрестков), ребер (позиций для дорог) и граней (гексов) для эффективной работы игровой логики. AAG:
[Создание вершин графа]: Система -> Для каждого гекса определяет 6 вершин (углов) -> Объединяет вершины, общие для нескольких гексов -> Присваивает уникальные идентификаторы каждой вершине -> Сохраняет координаты вершин для рендеринга.
Предположение: Всего 54 вершины в стандартном поле.
Риск: Низкий.

[Создание ребер графа]: Система -> Для каждой пары смежных вершин создает ребро -> Присваивает уникальные идентификаторы ребрам -> Связывает ребра с вершинами (2 вершины на ребро).
Предположение: Всего 72 ребра в стандартном поле.
Риск: Низкий.

[Связывание гексов с вершинами и ребрами]: Система -> Для каждого гекса сохраняет список из 6 смежных вершин -> Для каждого гекса сохраняет список из 6 смежных ребер -> Создает обратные связи (вершина знает о смежных гексах, ребро знает о смежных гексах).
Предположение: Эта структура необходима для быстрой валидации строительства и распределения ресурсов.
Риск: Средний - ошибки в построении графа приведут к некорректной логике игры.
Ключевые слова: [graph-structure, vertices, edges, hex-connections, data-structure] END_LOGIC_BLOCK_GRAPH_STRUCTURE
START_LOGIC_BLOCK_PLAYER_INIT
Назначение: Инициализация игроков и распределение начальных ресурсов. Требование: Система должна создать от 2 до 4 игроков (человек + компьютеры), назначить им цвета и начальные ресурсы. AAG:
[Создание игроков]: Система (Перед стартом игры) -> Получает параметры (количество игроков, имя человека, цвет человека) -> Создает объекты игроков:
  - 1 игрок-человек с указанным именем и цветом
  - (N-1) игроков-компьютеров с именами "Компьютер 1", "Компьютер 2", и т.д.
-> Назначает уникальные цвета каждому игроку (красный, синий, белый, оранжевый).
Предположение: Цвета не дублируются.
Риск: Низкий.

[Инициализация ресурсов игроков]: Система -> Для каждого игрока создает пустую "руку" (набор карт ресурсов):
  - Дерево: 0
  - Глина: 0
  - Шерсть: 0
  - Зерно: 0
  - Руда: 0
-> Создает пустой набор карт развития для каждого игрока.
Предположение: Игроки не начинают с ресурсами (получат их после размещения второго поселения).
Риск: Низкий.

[Инициализация счетчиков]: Система -> Для каждого игрока инициализирует счетчики:
  - Победные очки: 0
  - Разыгранные рыцари: 0
  - Длина самой длинной дороги: 0
  - Фишки построек:
    * Дороги: 15
    * Поселения: 5
    * Города: 4
Предположение: Фишки ограничены (нельзя построить больше, чем доступно).
Риск: Низкий.

[Определение порядка ходов]: Система -> Случайным образом определяет порядок ходов игроков -> Сохраняет последовательность -> Устанавливает первого игрока как активного.
Предположение: Порядок определяется один раз в начале игры и не меняется.
Риск: Низкий.
Ключевые слова: [player-initialization, resource-hand, development-cards, turn-order, player-pieces] END_LOGIC_BLOCK_PLAYER_INIT
END_TZ_SECTION_FR-GAME-INIT
BEGIN_TZ_SECTION_FR-INITIAL-PLACEMENT: Начальная расстановка
START_LOGIC_BLOCK_PLACEMENT_VALIDATION
Назначение: Валидация размещения поселений и дорог по правилам игры. Требование: Система должна проверять, что размещение построек соответствует правилам Catan. AAG:
[Проверка правила расстояния для поселений]: Система (При попытке размещения поселения) -> Получает выбранную вершину -> Проверяет, что вершина свободна (нет поселения/города) -> Находит все смежные вершины (на расстоянии 1 ребро) -> Проверяет, что на смежных вершинах нет поселений/городов -> Если все условия выполнены, возвращает TRUE, иначе FALSE.
Предположение: Правило расстояния = минимум 2 ребра между поселениями.
Риск: Средний - ошибка в проверке нарушит правила игры.

[Проверка связности дороги]: Система (При попытке размещения дороги) -> Получает выбранное ребро -> Проверяет, что ребро свободно (нет дороги) -> Проверяет одно из условий:
  - Одна из 2 вершин ребра содержит поселение/город игрока
  - Одно из смежных ребер содержит дорогу игрока
-> Если хотя бы одно условие выполнено, возвращает TRUE, иначе FALSE.
Предположение: В фазе начальной расстановки дорога должна быть смежна с только что размещенным поселением.
Риск: Средний.

[Проверка доступности позиции на воде]: Система (При проверке вершины) -> Определяет, является ли вершина "водной" (связана менее чем с 3 гексами) -> Для начальной расстановки разрешает размещение на любых вершинах, кроме полностью находящихся в воде (0 смежных гексов).
Предположение: Большинство вершин на границе поля доступны для строительства.
Риск: Низкий.
Ключевые слова: [validation, distance-rule, connectivity, settlement-placement, road-placement] END_LOGIC_BLOCK_PLACEMENT_VALIDATION
START_LOGIC_BLOCK_INITIAL_SETTLEMENT_ROUND_1
Назначение: Первый раунд начальной расстановки (прямой порядок). Требование: Каждый игрок размещает 1 поселение и 1 дорогу в порядке очереди. AAG:
[Размещение первого поселения]: Игрок (Прямой порядок: 1 -> 2 -> 3 -> 4) -> Выбирает свободную вершину, соблюдающую правило расстояния -> Система валидирует выбор -> Размещает поселение игрока на вершине -> Уменьшает счетчик доступных поселений игрока на 1 -> Переходит к размещению дороги.
Предположение: Игрок не получает победные очки за первое поселение до завершения начальной расстановки.
Риск: Низкий.

[Размещение первой дороги]: Игрок (После размещения первого поселения) -> Выбирает одно из 3 ребер, смежных с только что размещенным поселением -> Система валидирует выбор -> Размещает дорогу игрока на ребре -> Уменьшает счетчик доступных дорог игрока на 1 -> Передает ход следующему игроку.
Предположение: Дорога должна быть размещена немедленно после поселения.
Риск: Низкий.

[Итерация по игрокам]: Система -> Повторяет процесс для всех игроков в прямом порядке -> После завершения раунда переходит ко второму раунду.
Предположение: Все игроки успешно размещают поселение и дорогу.
Риск: Низкий.
Ключевые слова: [initial-placement, round-1, forward-order, first-settlement, first-road] END_LOGIC_BLOCK_INITIAL_SETTLEMENT_ROUND_1
START_LOGIC_BLOCK_INITIAL_SETTLEMENT_ROUND_2
Назначение: Второй раунд начальной расстановки (обратный порядок). Требование: Каждый игрок размещает 2-е поселение и 2-ю дорогу в обратном порядке и получает стартовые ресурсы. AAG:
[Размещение второго поселения]: Игрок (Обратный порядок: 4 -> 3 -> 2 -> 1) -> Выбирает свободную вершину, соблюдающую правило расстояния -> Система валидирует выбор -> Размещает поселение игрока на вершине -> Уменьшает счетчик доступных поселений игрока на 1 -> Переходит к размещению дороги.
Предположение: Второе поселение не может быть размещено рядом с первым (правило расстояния действует).
Риск: Низкий.

[Размещение второй дороги]: Игрок (После размещения второго поселения) -> Выбирает одно из 3 ребер, смежных с только что размещенным поселением -> Система валидирует выбор -> Размещает дорогу игрока на ребре -> Уменьшает счетчик доступных дорог игрока на 1 -> Переходит к получению стартовых ресурсов.
Предположение: Дорога должна быть размещена немедленно после поселения.
Риск: Низкий.

[Выдача стартовых ресурсов]: Система (После размещения второго поселения и дороги) -> Находит 3 гекса, смежных со вторым поселением -> Для каждого гекса (кроме пустыни) выдает игроку 1 карту соответствующего ресурса -> Обновляет руку игрока -> Передает ход следующему игроку (в обратном порядке).
Предположение: Гексы с разбойником (пустыня в начале игры) не дают ресурсы.
Риск: Низкий.

[Итерация по игрокам]: Система -> Повторяет процесс для всех игроков в обратном порядке -> После завершения раунда начисляет победные очки за поселения (2 ОП каждому игроку) -> Переходит к основной фазе игры.
Предположение: Все игроки имеют по 2 поселения, 2 дороги и стартовые ресурсы.
Риск: Низкий.
Ключевые слова: [initial-placement, round-2, reverse-order, second-settlement, starting-resources] END_LOGIC_BLOCK_INITIAL_SETTLEMENT_ROUND_2
END_TZ_SECTION_FR-INITIAL-PLACEMENT
BEGIN_TZ_SECTION_FR-TURN-CYCLE: Игровой цикл
START_LOGIC_BLOCK_DICE_ROLL
Назначение: Генерация и обработка броска кубиков. Требование: Система должна генерировать два случайных числа от 1 до 6 и обрабатывать результат. AAG:
[Генерация броска кубиков]: Игрок (Начало хода) -> Инициирует бросок кубиков -> Система генерирует 2 случайных числа (1-6) -> Вычисляет сумму -> Отображает результат -> Переходит к обработке результата.
Предположение: Генератор случайных чисел равномерно распределен.
Риск: Низкий.

[Маршрутизация по результату]: Система (После броска) -> Если сумма = 7, переходит к активации разбойника -> Если сумма = 2-6 или 8-12, переходит к распределению ресурсов.
Предположение: Каждый бросок обрабатывается только один раз.
Риск: Низкий.
Ключевые слова: [dice-roll, random-generation, turn-start, game-flow] END_LOGIC_BLOCK_DICE_ROLL
START_LOGIC_BLOCK_RESOURCE_DISTRIBUTION
Назначение: Распределение ресурсов игрокам после броска кубиков. Требование: Система должна найти все гексы с выпавшим числом и выдать ресурсы владельцам смежных поселений/городов. AAG:
[Поиск активных гексов]: Система (После броска 2-6 или 8-12) -> Находит все гексы, у которых числовой жетон соответствует выпавшей сумме -> Фильтрует гексы, на которых стоит разбойник (они не дают ресурсы) -> Получает список активных гексов.
Предположение: Гексы с разбойником не участвуют в распределении.
Риск: Низкий.

[Определение получателей ресурсов]: Система (Для каждого активного гекса) -> Находит все 6 смежных вершин гекса -> Для каждой вершины проверяет наличие поселения или города -> Если есть постройка, добавляет владельца в список получателей с количеством карт:
  - Поселение: 1 карта ресурса гекса
  - Город: 2 карты ресурса гекса
-> Группирует получателей по игрокам и ресурсам.
Предположение: Один игрок может получить несколько карт одного ресурса за один бросок.
Риск: Низкий.

[Выдача ресурсов]: Система -> Для каждого игрока в списке получателей добавляет соответствующее количество карт ресурсов в руку -> Обновляет отображение ресурсов -> Логирует событие в журнал игры.
Предположение: Банк имеет неограниченное количество ресурсов.
Риск: Низкий.
Ключевые слова: [resource-distribution, hex-activation, settlements, cities, resource-cards] END_LOGIC_BLOCK_RESOURCE_DISTRIBUTION
START_LOGIC_BLOCK_ROBBER_ACTIVATION
Назначение: Обработка выпадения числа 7 (активация разбойника). Требование: При выпадении 7 игроки с более чем 7 картами сбрасывают половину, текущий игрок перемещает разбойника и крадет карту. AAG:
[Сброс карт]: Система (После выпадения 7) -> Для каждого игрока подсчитывает общее количество карт ресурсов в руке -> Если количество > 7:
  - Вычисляет количество карт для сброса = floor(количество / 2)
  - Запрашивает у игрока выбор карт для сброса (человек выбирает через UI, ИИ выбирает случайно или по стратегии)
  - Удаляет выбранные карты из руки игрока
  - Возвращает карты в банк
-> Логирует события сброса.
Предположение: Сброс происходит одновременно для всех игроков с >7 картами перед перемещением разбойника.
Риск: Средний - UI для выбора карт должен быть интуитивным.

[Перемещение разбойника]: Система (После сброса карт) -> Переходит в режим перемещения разбойника для текущего игрока -> Игрок выбирает любой гекс (кроме текущего с разбойником) -> Система валидирует выбор -> Перемещает разбойника на новый гекс -> Сохраняет новую позицию разбойника -> Переходит к краже карты.
Предположение: Разбойник должен быть перемещен обязательно (нельзя оставить на месте).
Риск: Низкий.

[Кража карты]: Система (После перемещения разбойника) -> Находит все вершины, смежные с новым гексом разбойника -> Для каждой вершины проверяет наличие поселения/города других игроков (не текущего) -> Создает список потенциальных жертв (игроков с постройками на гексе) -> Фильтрует жертв с 0 карт ресурсов -> Если список не пуст:
  - Игрок выбирает жертву (человек выбирает через UI, ИИ выбирает случайно или по стратегии)
  - Система выбирает случайную карту ресурса из руки жертвы (жертва не видит, какую карту украли до обновления)
  - Перемещает карту из руки жертвы в руку текущего игрока
  - Логирует событие кражи (без указания типа ресурса для других игроков)
-> Если список пуст, пропускает кражу.
Предположение: Игрок не может украсть карту у себя или у игрока без карт.
Риск: Средний - логика выбора жертвы и случайной карты должна быть корректной.
Ключевые слова: [robber, seven-rolled, discard-cards, robber-movement, steal-card] END_LOGIC_BLOCK_ROBBER_ACTIVATION
START_LOGIC_BLOCK_ACTION_PHASE
Назначение: Фаза действий игрока (строительство, торговля, покупка карт). Требование: Игрок может выполнять любые доступные действия в любом порядке и количестве до завершения хода. AAG:
[Определение доступных действий]: Система (В течение фазы действий) -> Непрерывно проверяет наличие ресурсов у игрока -> Определяет список доступных действий:
  - Построить дорогу (если есть 1 дерево + 1 глина + доступные позиции + доступные фишки)
  - Построить поселение (если есть 1 дерево + 1 глина + 1 шерсть + 1 зерно + доступные позиции + доступные фишки)
  - Улучшить до города (если есть 3 руды + 2 зерна + есть свои поселения + доступные фишки городов)
  - Купить карту развития (если есть 1 шерсть + 1 зерно + 1 руда + колода не пуста)
  - Торговать (всегда доступно, но требует минимум 2-4 карты для обмена)
  - Разыграть карту развития (если есть доступные карты, не купленные в этом ходу)
-> Обновляет UI с подсветкой доступных кнопок.
Предположение: Проверка выполняется после каждого действия игрока.
Риск: Низкий.

[Ожидание действия игрока]: Система -> Ожидает выбор действия от игрока (человек кликает кнопку, ИИ выбирает по стратегии) -> При выборе действия вызывает соответствующий логический блок -> После завершения действия возвращается к проверке доступных действий -> Повторяет цикл до нажатия "Закончить ход".
Предположение: Игрок может выполнить несколько действий за ход.
Риск: Низкий.
Ключевые слова: [action-phase, available-actions, player-turn, game-loop] END_LOGIC_BLOCK_ACTION_PHASE
START_LOGIC_BLOCK_END_TURN
Назначение: Завершение хода и передача управления следующему игроку. Требование: Игрок завершает свой ход, система передает управление следующему игроку в порядке очереди. AAG:
[Завершение хода]: Игрок -> Нажимает кнопку "Закончить ход" -> Система фиксирует конец хода текущего игрока -> Логирует событие -> Переходит к следующему игроку.
Предположение: Игрок может завершить ход в любой момент фазы действий.
Риск: Низкий.

[Передача хода]: Система -> Определяет следующего игрока в порядке очереди (циклически: 1 -> 2 -> 3 -> 4 -> 1 -> ...) -> Устанавливает его как активного -> Сбрасывает флаги для нового хода (например, "кубики брошены" = FALSE) -> Если следующий игрок - ИИ, автоматически запускает логику хода ИИ -> Если следующий игрок - человек, ожидает его действий.
Предположение: Порядок ходов не меняется в течение игры.
Риск: Низкий.
Ключевые слова: [end-turn, turn-order, next-player, turn-transition] END_LOGIC_BLOCK_END_TURN
END_TZ_SECTION_FR-TURN-CYCLE
BEGIN_TZ_SECTION_FR-BUILDING: Строительство
START_LOGIC_BLOCK_BUILD_ROAD
Назначение: Строительство дороги игроком. Требование: Игрок должен иметь возможность построить дорогу при наличии ресурсов и доступных позиций. AAG:
[Проверка ресурсов]: Система (При инициации строительства дороги) -> Проверяет наличие 1 дерева + 1 глины в руке игрока -> Если ресурсов недостаточно, блокирует действие и показывает сообщение -> Если ресурсы есть, переходит к выбору позиции.
Предположение: Проверка выполняется до входа в режим размещения.
Риск: Низкий.

[Проверка доступных фишек]: Система -> Проверяет счетчик доступных дорог игрока -> Если счетчик = 0, блокирует действие и показывает сообщение "Все дороги построены" -> Если фишки доступны, продолжает.
Предположение: Максимум 15 дорог на игрока.
Риск: Низкий.

[Выбор позиции]: Система -> Переходит в режим выбора ребра -> Находит все ребра, смежные с дорогами/поселениями/городами игрока -> Фильтрует свободные ребра -> Подсвечивает доступные позиции -> Ожидает выбор игрока.
Предположение: Дорога может быть построена только на ребре, связанном с существующими постройками.
Риск: Средний - проверка связности должна быть корректной.

[Размещение дороги]: Игрок -> Выбирает ребро -> Система валидирует выбор (связность, свободность) -> Списывает 1 дерево + 1 глину из руки игрока -> Размещает дорогу игрока на ребре -> Уменьшает счетчик доступных дорог на 1 -> Обновляет отображение -> Вызывает пересчет длины самой длинной дороги -> Логирует событие.
Предположение: Дорога размещается мгновенно после выбора.
Риск: Низкий.
Ключевые слова: [build-road, resource-cost, position-validation, road-placement] END_LOGIC_BLOCK_BUILD_ROAD
START_LOGIC_BLOCK_BUILD_SETTLEMENT
Назначение: Строительство поселения игроком. Требование: Игрок должен иметь возможность построить поселение при наличии ресурсов, доступных позиций и фишек. AAG:
[Проверка ресурсов]: Система (При инициации строительства поселения) -> Проверяет наличие 1 дерева + 1 глины + 1 шерсти + 1 зерна в руке игрока -> Если ресурсов недостаточно, блокирует действие -> Если ресурсы есть, переходит к проверке фишек.
Предположение: Поселение — наиболее дорогая базовая постройка.
Риск: Низкий.

[Проверка доступных фишек]: Система -> Проверяет счетчик доступных поселений игрока -> Если счетчик = 0, блокирует действие и показывает сообщение "Все поселения построены" -> Если фишки доступны, продолжает.
Предположение: Максимум 5 поселений на игрока (но они могут быть улучшены до городов, освобождая фишку).
Риск: Низкий.

[Выбор позиции]: Система -> Переходит в режим выбора вершины -> Находит все вершины, смежные с дорогами игрока -> Фильтрует вершины, соблюдающие правило расстояния (нет поселений/городов на смежных вершинах) -> Фильтрует свободные вершины -> Подсвечивает доступные позиции -> Ожидает выбор игрока.
Предположение: Поселение должно быть связано дорогой и соблюдать правило расстояния.
Риск: Средний - валидация сложнее, чем для дороги.

[Размещение поселения]: Игрок -> Выбирает вершину -> Система валидирует выбор -> Списывает 1 дерево + 1 глину + 1 шерсть + 1 зерно из руки игрока -> Размещает поселение игрока на вершине -> Уменьшает счетчик доступных поселений на 1 -> Добавляет 1 победное очко игроку -> Проверяет, есть ли на вершине доступ к порту, если да, добавляет игроку доступ к торговому курсу порта -> Обновляет отображение -> Проверяет условие победы -> Логирует событие.
Предположение: Поселение сразу приносит 1 ОП.
Риск: Низкий.
Ключевые слова: [build-settlement, resource-cost, distance-rule, victory-points, port-access] END_LOGIC_BLOCK_BUILD_SETTLEMENT
START_LOGIC_BLOCK_UPGRADE_TO_CITY
Назначение: Улучшение поселения до города. Требование: Игрок должен иметь возможность улучшить свое поселение до города при наличии ресурсов и доступных фишек городов. AAG:
[Проверка ресурсов]: Система (При инициации улучшения до города) -> Проверяет наличие 3 руды + 2 зерна в руке игрока -> Если ресурсов недостаточно, блокирует действие -> Если ресурсы есть, переходит к проверке фишек.
Предположение: Город — самая дорогая постройка.
Риск: Низкий.

[Проверка доступных фишек]: Система -> Проверяет счетчик доступных городов игрока -> Если счетчик = 0, блокирует действие и показывает сообщение "Все города построены" -> Если фишки доступны, продолжает.
Предположение: Максимум 4 города на игрока.
Риск: Низкий.

[Проверка наличия поселений]: Система -> Проверяет, есть ли у игрока поселения на поле -> Если поселений нет, блокирует действие -> Если есть, переходит к выбору.
Предположение: Нельзя улучшить то, чего нет.
Риск: Низкий.

[Выбор поселения]: Система -> Переходит в режим выбора поселения -> Подсвечивает все поселения игрока на поле -> Ожидает выбор игрока.
Предположение: Игрок может выбрать любое свое поселение.
Риск: Низкий.

[Улучшение до города]: Игрок -> Выбирает поселение -> Система валидирует выбор (принадлежит игроку, является поселением) -> Списывает 3 руды + 2 зерна из руки игрока -> Заменяет поселение на город на выбранной вершине -> Увеличивает счетчик доступных поселений на 1 (фишка поселения возвращается) -> Уменьшает счетчик доступных городов на 1 -> Добавляет 1 победное очко игроку (теперь вершина дает 2 ОП вместо 1) -> Обновляет отображение -> Проверяет условие победы -> Логирует событие.
Предположение: Город дает 2 карты ресурса вместо 1 при распределении.
Риск: Низкий.
Ключевые слова: [upgrade-city, resource-cost, settlement-replacement, victory-points] END_LOGIC_BLOCK_UPGRADE_TO_CITY
END_TZ_SECTION_FR-BUILDING
BEGIN_TZ_SECTION_FR-TRADING: Торговля
START_LOGIC_BLOCK_TRADE_BANK_4_TO_1
Назначение: Обмен ресурсов с банком по базовому курсу 4:1. Требование: Игрок может обменять 4 карты любого одного ресурса на 1 карту любого другого ресурса. AAG:
[Проверка ресурсов для обмена]: Система (При инициации торговли 4:1) -> Проверяет, есть ли у игрока хотя бы 4 карты любого одного типа ресурса -> Если нет, блокирует действие -> Если есть, переходит к выбору.
Предположение: Игрок должен иметь 4 карты именно одного типа (например, 4 дерева).
Риск: Низкий.

[Выбор отдаваемого ресурса]: Игрок -> Выбирает тип ресурса для обмена (дерево/глина/шерсть/зерно/руда) -> Указывает количество карт (кратное 4) -> Система валидирует наличие -> Переходит к выбору получаемого ресурса.
Предположение: Один обмен = 4 карты одного типа за 1 карту другого типа.
Риск: Низкий.

[Выбор получаемого ресурса]: Игрок -> Выбирает тип желаемого ресурса -> Система вычисляет количество получаемых карт (количество отдаваемых / 4) -> Отображает предварительный результат обмена.
Предположение: Игрок не может выбрать тот же ресурс, что отдает.
Риск: Низкий.

[Выполнение обмена]: Игрок -> Подтверждает обмен -> Система списывает отдаваемые карты из руки игрока -> Добавляет получаемые карты в руку игрока -> Обновляет отображение -> Логирует событие.
Предположение: Банк имеет неограниченное количество ресурсов.
Риск: Низкий.
Ключевые слова: [trade-bank, 4:1-ratio, resource-exchange, base-trading] END_LOGIC_BLOCK_TRADE_BANK_4_TO_1
START_LOGIC_BLOCK_TRADE_PORT_3_TO_1
Назначение: Обмен ресурсов через общий порт по курсу 3:1. Требование: Игрок с доступом к общему порту может обменять 3 карты любого одного ресурса на 1 карту любого другого ресурса. AAG:
[Проверка доступа к порту]: Система (При инициации торговли 3:1) -> Проверяет, есть ли у игрока поселение/город на вершине, связанной с общим портом -> Если нет, действие недоступно -> Если есть, переходит к проверке ресурсов.
Предположение: Доступ к порту определяется при размещении поселения и сохраняется в данных игрока.
Риск: Средний - требуется корректное связывание портов с вершинами.

[Проверка ресурсов для обмена]: Система -> Проверяет, есть ли у игрока хотя бы 3 карты любого одного типа ресурса -> Если нет, блокирует действие -> Если есть, переходит к выбору.
Предположение: Логика аналогична 4:1, но с другим соотношением.
Риск: Низкий.

[Выбор и выполнение обмена]: Игрок -> Выбирает 3 карты одного типа для обмена -> Выбирает 1 карту желаемого ресурса -> Система валидирует и выполняет обмен (аналогично 4:1) -> Логирует событие с указанием использования порта 3:1.
Предположение: Система автоматически предлагает лучший доступный курс (3:1 если доступен, иначе 4:1).
Риск: Низкий.
Ключевые слова: [trade-port, 3:1-ratio, general-port, port-access] END_LOGIC_BLOCK_TRADE_PORT_3_TO_1
START_LOGIC_BLOCK_TRADE_PORT_2_TO_1
Назначение: Обмен ресурсов через специализированный порт по курсу 2:1. Требование: Игрок с доступом к специализированному порту может обменять 2 карты определенного ресурса на 1 карту любого другого ресурса. AAG:
[Проверка доступа к специализированному порту]: Система (При инициации торговли 2:1) -> Проверяет, есть ли у игрока поселение/город на вершине, связанной со специализированным портом -> Определяет тип ресурса специализированного порта (дерево/глина/шерсть/зерно/руда) -> Если доступа нет, действие недоступно -> Если есть, переходит к проверке ресурсов.
Предположение: Игрок может иметь доступ к нескольким специализированным портам одновременно.
Риск: Средний.

[Проверка ресурсов для обмена]: Система -> Проверяет, есть ли у игрока хотя бы 2 карты ресурса, соответствующего специализированному порту -> Если нет, блокирует действие -> Если есть, переходит к выбору.
Предположение: Обмен доступен только для ресурса, соответствующего порту.
Риск: Низкий.

[Выбор и выполнение обмена]: Игрок -> Выбирает 2 карты специализированного ресурса для обмена -> Выбирает 1 карту желаемого ресурса (любого) -> Система валидирует и выполняет обмен -> Логирует событие с указанием использования порта 2:1 (тип ресурса).
Предположение: 2:1 — наиболее выгодный курс.
Риск: Низкий.
Ключевые слова: [trade-port, 2:1-ratio, specialized-port, resource-specific-trade] END_LOGIC_BLOCK_TRADE_PORT_2_TO_1
START_LOGIC_BLOCK_TRADE_UI
Назначение: Интерфейс для управления торговлей. Требование: Игрок должен иметь единый интерфейс для выбора типа обмена и ресурсов. AAG:
[Открытие интерфейса торговли]: Игрок (Во время фазы действий) -> Нажимает кнопку "Торговать" -> Система открывает окно/панель торговли -> Отображает:
  - Текущие ресурсы игрока (с количеством)
  - Доступные торговые курсы (4:1 всегда, 3:1 если есть общий порт, 2:1 для специализированных портов с указанием ресурса)
  - Секцию выбора отдаваемого ресурса (тип + количество)
  - Секцию выбора получаемого ресурса (тип)
  - Кнопки "Обменять" и "Отмена".
Предположение: Интерфейс автоматически определяет и предлагает лучшие доступные курсы.
Риск: Низкий.

[Автоматическое определение курса]: Система (При выборе ресурса для обмена) -> Проверяет доступ к портам игрока -> Определяет наилучший курс для выбранного ресурса:
  - Если есть специализированный порт для этого ресурса: 2:1
  - Иначе если есть общий порт: 3:1
  - Иначе: 4:1
-> Отображает активный курс и вычисляет количество получаемых карт.
Предположение: Система помогает игроку сделать оптимальный обмен.
Риск: Низкий.

[Валидация и выполнение обмена]: Игрок -> Выбирает ресурсы и нажимает "Обменять" -> Система валидирует:
  - Наличие достаточного количества отдаваемого ресурса
  - Корректность курса (кратность 2, 3 или 4)
  - Доступ к соответствующему порту (для 3:1 и 2:1)
-> Если валидация пройдена, выполняет обмен (вызывает соответствующий логический блок) -> Закрывает интерфейс торговли или позволяет выполнить еще один обмен.
Предположение: Игрок может совершить несколько обменов подряд.
Риск: Низкий.
Ключевые слова: [trade-UI, trade-interface, automatic-rate-detection, user-interaction] END_LOGIC_BLOCK_TRADE_UI
END_TZ_SECTION_FR-TRADING
BEGIN_TZ_SECTION_FR-DEVELOPMENT-CARDS: Карты развития
START_LOGIC_BLOCK_BUY_DEVELOPMENT_CARD
Назначение: Покупка карты развития из колоды. Требование: Игрок может купить случайную карту развития при наличии ресурсов и непустой колоде. AAG:
[Проверка ресурсов]: Система (При инициации покупки карты) -> Проверяет наличие 1 шерсти + 1 зерна + 1 руды в руке игрока -> Если ресурсов недостаточно, блокирует действие -> Если ресурсы есть, переходит к проверке колоды.
Предположение: Карта развития стоит столько же, сколько поселение, но без глины и дерева.
Риск: Низкий.

[Проверка колоды]: Система -> Проверяет, не пуста ли колода карт развития -> Если колода пуста, блокирует действие и показывает сообщение "Карты развития закончились" -> Если колода не пуста, переходит к покупке.
Предположение: Колода содержит ограниченное количество карт (25 в базовой игре).
Риск: Низкий.

[Покупка карты]: Игрок -> Подтверждает покупку -> Система списывает 1 шерсть + 1 зерно + 1 руду из руки игрока -> Выбирает случайную карту из колоды -> Удаляет карту из колоды -> Добавляет карту в руку игрока -> Помечает карту как "куплена в этом ходу" (не может быть разыграна) -> Обновляет отображение -> Логирует событие (без указания типа карты для других игроков).
Предположение: Игрок видит тип купленной карты, другие игроки видят только количество карт развития.
Риск: Низкий.
Ключевые слова: [buy-development-card, resource-cost, deck, random-card] END_LOGIC_BLOCK_BUY_DEVELOPMENT_CARD
START_LOGIC_BLOCK_DEVELOPMENT_DECK_INIT
Назначение: Инициализация колоды карт развития. Требование: Система должна создать колоду из 25 карт развития с правильным распределением типов. AAG:
[Создание колоды]: Система (При инициализации игры) -> Создает колоду из 25 карт:
  - 14 карт "Рыцарь"
  - 2 карты "Монополия"
  - 2 карты "Строительство дорог"
  - 2 карты "Изобретение"
  - 5 карт победных очков:
    * 1 "Университет" (1 ОП)
    * 1 "Библиотека" (1 ОП)
    * 1 "Рыночная площадь" (1 ОП)
    * 1 "Большой зал" (1 ОП)
    * 1 "Часовня" (1 ОП)
-> Перемешивает колоду случайным образом -> Сохраняет в состоянии игры.
Предположение: Колода создается один раз в начале игры и не пополняется.
Риск: Низкий.
Ключевые слова: [development-deck, card-types, deck-initialization, shuffling] END_LOGIC_BLOCK_DEVELOPMENT_DECK_INIT
START_LOGIC_BLOCK_PLAY_KNIGHT
Назначение: Разыгрывание карты "Рыцарь". Требование: Игрок может разыграть рыцаря для перемещения разбойника и кражи карты. AAG:
[Проверка возможности разыгрывания]: Система (При попытке разыграть рыцаря) -> Проверяет, что карта не была куплена в текущем ходу -> Если была куплена в этом ходу, блокирует действие с сообщением -> Если может быть разыграна, переходит к действию.
Предположение: Рыцарь может быть разыгран в любой момент хода (до или после броска кубиков).
Риск: Низкий.

[Перемещение разбойника]: Игрок -> Подтверждает разыгрывание рыцаря -> Система удаляет карту из руки игрока -> Увеличивает счетчик разыгранных рыцарей игрока на 1 -> Переходит в режим перемещения разбойника (аналогично выпадению 7, но без сброса карт) -> Игрок выбирает новый гекс -> Система перемещает разбойника -> Переходит к краже карты (аналогично выпадению 7).
Предположение: Логика перемещения и кражи идентична выпадению 7.
Риск: Низкий.

[Проверка "Самой большой армии"]: Система (После увеличения счетчика рыцарей) -> Проверяет, достиг ли игрок 3+ рыцарей -> Если да, проверяет, кто текущий держатель титула "Самая большая армия" -> Если титул свободен (никто не имеет) и у игрока ≥3 рыцаря:
  - Присваивает титул игроку
  - Добавляет 2 победных очка игроку
-> Если титул занят и у игрока рыцарей строго больше, чем у текущего держателя:
  - Забирает титул у текущего держателя (убирает 2 ОП)
  - Присваивает титул игроку (добавляет 2 ОП)
-> Обновляет отображение -> Проверяет условие победы -> Логирует событие.
Предположение: Титул передается только при строгом превышении количества рыцарей.
Риск: Средний - логика передачи титула должна быть корректной.
Ключевые слова: [play-knight, robber-movement, steal-card, largest-army, knight-count] END_LOGIC_BLOCK_PLAY_KNIGHT
START_LOGIC_BLOCK_PLAY_MONOPOLY
Назначение: Разыгрывание карты "Монополия". Требование: Игрок может разыграть монополию для получения всех карт выбранного ресурса от всех противников. AAG:
[Проверка возможности разыгрывания]: Система (При попытке разыграть монополию) -> Проверяет, что карта не была куплена в текущем ходу -> Если может быть разыграна, переходит к выбору ресурса.
Предположение: Монополия может быть разыграна в любой момент хода.
Риск: Низкий.

[Выбор ресурса]: Игрок -> Подтверждает разыгрывание монополии -> Система открывает интерфейс выбора типа ресурса (5 кнопок: дерево/глина/шерсть/зерно/руда) -> Игрок выбирает тип ресурса.
Предположение: Игрок может выбрать любой ресурс, даже если ни у кого его нет.
Риск: Низкий.

[Сбор ресурсов]: Система (После выбора ресурса) -> Удаляет карту из руки игрока -> Для каждого другого игрока:
  - Подсчитывает количество карт выбранного ресурса
  - Удаляет все эти карты из руки противника
  - Добавляет их в руку текущего игрока
-> Обновляет отображение для всех игроков -> Логирует событие с указанием типа ресурса и количества собранных карт.
Предположение: Даже если собрано 0 карт, карта монополии считается разыгранной.
Риск: Низкий.
Ключевые слова: [play-monopoly, resource-collection, card-effect, all-players] END_LOGIC_BLOCK_PLAY_MONOPOLY
START_LOGIC_BLOCK_PLAY_ROAD_BUILDING
Назначение: Разыгрывание карты "Строительство дорог". Требование: Игрок может разыграть карту для бесплатного размещения 2 дорог. AAG:
[Проверка возможности разыгрывания]: Система (При попытке разыграть строительство дорог) -> Проверяет, что карта не была куплена в текущем ходу -> Проверяет, есть ли у игрока доступные фишки дорог (минимум 1) -> Если может быть разыграна, переходит к размещению.
Предположение: Если у игрока осталась только 1 фишка дороги, он может разыграть карту и построить только 1 дорогу.
Риск: Низкий.

[Размещение первой дороги]: Игрок -> Подтверждает разыгрывание -> Система удаляет карту из руки игрока -> Переходит в режим размещения дороги (аналогично обычному строительству, но без списания ресурсов) -> Игрок выбирает ребро -> Система размещает дорогу -> Уменьшает счетчик доступных дорог на 1 -> Если счетчик дорог > 0, переходит к размещению второй дороги, иначе завершает действие.
Предположение: Дороги размещаются последовательно, а не одновременно.
Риск: Низкий.

[Размещение второй дороги]: Игрок -> Выбирает ребро для второй дороги -> Система размещает дорогу -> Уменьшает счетчик доступных дорог на 1 -> Вызывает пересчет длины самой длинной дороги -> Обновляет отображение -> Логирует событие.
Предположение: Вторая дорога может быть размещена в любой доступной позиции (не обязательно смежной с первой).
Риск: Низкий.

[Отмена размещения]: Игрок (Опционально) -> Может отменить размещение второй дороги, если не хочет или не может разместить -> Система завершает действие.
Предположение: Игрок не обязан размещать обе дороги, если не хочет.
Риск: Низкий.
Ключевые слова: [play-road-building, free-roads, card-effect, sequential-placement] END_LOGIC_BLOCK_PLAY_ROAD_BUILDING
START_LOGIC_BLOCK_PLAY_YEAR_OF_PLENTY
Назначение: Разыгрывание карты "Изобретение" (Year of Plenty). Требование: Игрок может разыграть карту для получения 2 любых ресурсов из банка. AAG:
[Проверка возможности разыгрывания]: Система (При попытке разыграть изобретение) -> Проверяет, что карта не была куплена в текущем ходу -> Если может быть разыграна, переходит к выбору ресурсов.
Предположение: Изобретение может быть разыграно в любой момент хода.
Риск: Низкий.

[Выбор ресурсов]: Игрок -> Подтверждает разыгрывание -> Система открывает интерфейс выбора 2 ресурсов (5 кнопок для каждого выбора или возможность выбрать 2 одинаковых) -> Игрок выбирает первый ресурс -> Игрок выбирает второй ресурс (может быть таким же, как первый).
Предположение: Игрок может выбрать 2 разных ресурса или 2 одинаковых.
Риск: Низкий.

[Получение ресурсов]: Система (После выбора) -> Удаляет карту из руки игрока -> Добавляет 2 выбранные карты ресурсов в руку игрока -> Обновляет отображение -> Логирует событие с указанием выбранных ресурсов.
Предположение: Банк имеет неограниченное количество ресурсов.
Риск: Низкий.
Ключевые слова: [play-year-of-plenty, free-resources, card-effect, resource-selection] END_LOGIC_BLOCK_PLAY_YEAR_OF_PLENTY
START_LOGIC_BLOCK_VICTORY_POINT_CARDS
Назначение: Обработка карт победных очков. Требование: Карты победных очков должны автоматически учитываться при подсчете ОП игрока. AAG:
[Скрытое хранение]: Система (При получении карты ОП) -> Добавляет карту в руку игрока -> Помечает карту как "карта ОП" -> Не отображает тип карты другим игрокам (показывает только общее количество карт развития).
Предположение: Карты ОП не разыгрываются, они просто находятся в руке.
Риск: Низкий.

[Автоматический подсчет]: Система (При подсчете победных очков игрока) -> Сканирует руку игрока -> Подсчитывает количество карт победных очков -> Добавляет к общей сумме ОП игрока.
Предположение: Карты ОП всегда учитываются, даже если были куплены в текущем ходу.
Риск: Низкий.

[Раскрытие при победе]: Система (Когда игрок достигает 10 ОП) -> Раскрывает все карты ОП игрока на экране окончания игры -> Показывает названия карт в итоговой статистике.
Предположение: Карты ОП становятся видны только после победы.
Риск: Низкий.
Ключевые слова: [victory-point-cards, hidden-cards, automatic-counting, game-end-reveal] END_LOGIC_BLOCK_VICTORY_POINT_CARDS
END_TZ_SECTION_FR-DEVELOPMENT-CARDS
BEGIN_TZ_SECTION_FR-ACHIEVEMENTS: Достижения и победные очки
START_LOGIC_BLOCK_CALCULATE_VICTORY_POINTS
Назначение: Подсчет победных очков игрока. Требование: Система должна постоянно отслеживать и подсчитывать победные очки каждого игрока. AAG:
[Компоненты победных очков]: Система (При каждом изменении, влияющем на ОП) -> Подсчитывает для игрока:
  - Поселения: количество * 1 ОП
  - Города: количество * 2 ОП
  - Карты развития с победными очками: количество * 1 ОП
  - Титул "Самая длинная дорога": 2 ОП (если игрок держатель)
  - Титул "Самая большая армия": 2 ОП (если игрок держатель)
-> Суммирует все компоненты -> Сохраняет общее количество ОП игрока -> Обновляет отображение.
Предположение: Подсчет выполняется после каждого действия, влияющего на ОП.
Риск: Низкий.

[Триггеры пересчета]: Система -> Вызывает пересчет ОП при:
  - Строительстве поселения
  - Улучшении поселения до города
  - Покупке карты развития (если это карта ОП)
  - Изменении держателя титула "Самая длинная дорога"
  - Изменении держателя титула "Самая большая армия"
Предположение: Пересчет вызывается автоматически соответствующими логическими блоками.
Риск: Низкий.
Ключевые слова: [victory-points, scoring, settlements, cities, titles, achievement-tracking] END_LOGIC_BLOCK_CALCULATE_VICTORY_POINTS
START_LOGIC_BLOCK_CHECK_WIN_CONDITION
Назначение: Проверка условия победы. Требование: Система должна проверять, достиг ли игрок 10 победных очков, и объявлять победителя. AAG:
[Проверка 10 ОП]: Система (После каждого пересчета ОП) -> Проверяет, достиг ли активный игрок 10 или более победных очков -> Если да, переходит к объявлению победы -> Если нет, продолжает игру.
Предположение: Победа проверяется только во время хода игрока (не в середине хода противника).
Риск: Низкий.

[Объявление победы]: Система (Когда игрок достиг 10 ОП) -> Останавливает игровой процесс -> Фиксирует победителя -> Собирает итоговую статистику всех игроков -> Переходит к экрану окончания игры.
Предположение: Игра заканчивается немедленно при достижении 10 ОП.
Риск: Низкий.

[Предотвращение ложной победы]: Система -> Не засчитывает победу, если игрок временно достиг 10 ОП, а затем потерял титул (например, "Самую длинную дорогу") до конца своего хода.
Предположение: Победа фиксируется в конце действия, добавившего последние ОП.
Риск: Средний - требуется аккуратная обработка последовательности событий.
Ключевые слова: [win-condition, 10-victory-points, game-end, winner-declaration] END_LOGIC_BLOCK_CHECK_WIN_CONDITION
START_LOGIC_BLOCK_LONGEST_ROAD
Назначение: Расчет и управление титулом "Самая длинная дорога". Требование: Система должна отслеживать длину непрерывных цепей дорог и присваивать титул игроку с самой длинной дорогой (≥5). AAG:
[Расчет длины дороги]: Система (После постройки дороги) -> Для игрока, построившего дорогу, запускает алгоритм поиска длиннейшего пути:
  - Находит все ребра с дорогами игрока
  - Для каждого ребра запускает поиск в глубину (DFS) или алгоритм поиска пути
  - Учитывает разветвления (выбирает максимальную длину среди всех ветвей)
  - Игнорирует поселения/города противников, которые могут "разрывать" дорогу
  - Возвращает максимальную длину непрерывной цепи
-> Сохраняет длину в данных игрока.
Предположение: Поселения/города противников разрывают дорогу для подсчета длины.
Риск: Высокий - алгоритм поиска длиннейшего пути сложен и критичен для игры.

[Проверка на получение титула]: Система (После расчета длины) -> Если длина ≥ 5:
  - Проверяет, свободен ли титул "Самая длинная дорога"
  - Если свободен, присваивает титул игроку и добавляет 2 ОП
  - Если титул занят, сравнивает длину с длиной текущего держателя
  - Если длина игрока строго больше:
    * Забирает титул у текущего держателя (убирает 2 ОП)
    * Присваивает титул игроку (добавляет 2 ОП)
    * Логирует событие передачи титула
-> Обновляет отображение -> Проверяет условие победы.
Предположение: Титул передается только при строгом превышении длины (при равенстве остается у текущего держателя).
Риск: Средний.

[Потеря титула]: Система (Если действия других игроков разорвали дорогу держателя титула) -> Пересчитывает длину дороги держателя титула -> Если длина < 5 или другой игрок построил более длинную дорогу, пересматривает держателя титула -> Передает титул или оставляет свободным.
Предположение: Пересчет длины выполняется после каждого строительства поселения противником на дороге.
Риск: Высокий - требуется отслеживание разрывов дорог.
Ключевые слова: [longest-road, path-finding, road-chain, title-transfer, DFS-algorithm] END_LOGIC_BLOCK_LONGEST_ROAD
START_LOGIC_BLOCK_LARGEST_ARMY
Назначение: Расчет и управление титулом "Самая большая армия". Требование: Система должна отслеживать количество разыгранных рыцарей и присваивать титул игроку с наибольшей армией (≥3 рыцарей). AAG:
[Увеличение счетчика рыцарей]: Система (После разыгрывания рыцаря) -> Увеличивает счетчик разыгранных рыцарей игрока на 1 -> Переходит к проверке титула.
Предположение: Счетчик увеличивается сразу после разыгрывания рыцаря (до перемещения разбойника).
Риск: Низкий.

[Проверка на получение титула]: Система (После увеличения счетчика) -> Если счетчик ≥ 3:
  - Проверяет, свободен ли титул "Самая большая армия"
  - Если свободен, присваивает титул игроку и добавляет 2 ОП
  - Если титул занят, сравнивает счетчик с счетчиком текущего держателя
  - Если счетчик игрока строго больше:
    * Забирает титул у текущего держателя (убирает 2 ОП)
    * Присваивает титул игроку (добавляет 2 ОП)
    * Логирует событие передачи титула
-> Обновляет отображение -> Проверяет условие победы.
Предположение: Титул передается только при строгом превышении счетчика (при равенстве остается у текущего держателя).
Риск: Низкий.

[Постоянство счетчика]: Система -> Счетчик рыцарей игрока никогда не уменьшается (рыцари считаются "разыгранными" навсегда).
Предположение: Титул не может быть потерян после получения, если только другой игрок не разыграет больше рыцарей.
Риск: Низкий.
Ключевые слова: [largest-army, knight-count, title-transfer, permanent-counter] END_LOGIC_BLOCK_LARGEST_ARMY
END_TZ_SECTION_FR-ACHIEVEMENTS
BEGIN_TZ_SECTION_FR-AI: Искусственный интеллект
START_LOGIC_BLOCK_AI_TURN_FLOW
Назначение: Управление ходом ИИ-игрока. Требование: ИИ должен выполнять полный цикл хода автоматически с небольшими задержками для имитации "размышления". AAG:
[Запуск хода ИИ]: Система (Когда ход переходит к ИИ-игроку) -> Определяет, что активный игрок — компьютер -> Добавляет задержку 0.5-1 секунду (имитация размышления) -> Автоматически бросает кубики -> Обрабатывает результат броска (распределение ресурсов или активация разбойника) -> Переходит к фазе действий ИИ.
Предположение: Задержки делают игру более естественной для человека.
Риск: Низкий.

[Фаза действий ИИ]: Система (После броска кубиков) -> Вызывает логику принятия решений ИИ -> ИИ выполняет действия по приоритетам (строительство, торговля, покупка карт) -> После завершения всех действий автоматически завершает ход -> Передает ход следующему игроку.
Предположение: ИИ выполняет все действия последовательно с небольшими задержками между ними.
Риск: Низкий.
Ключевые слова: [AI-turn, turn-automation, AI-flow, thinking-delay] END_LOGIC_BLOCK_AI_TURN_FLOW
START_LOGIC_BLOCK_AI_INITIAL_PLACEMENT
Назначение: Стратегия ИИ для начальной расстановки. Требование: ИИ должен выбирать оптимальные позиции для первых двух поселений на основе вероятностей ресурсов. AAG:
[Оценка вершин]: ИИ (Фаза начальной расстановки) -> Для каждой доступной вершины (соблюдающей правило расстояния):
  - Находит 3 смежных гекса (или меньше, если вершина на краю)
  - Для каждого гекса получает вероятность выпадения числа (рассчитанную ранее)
  - Суммирует вероятности всех смежных гексов
  - Учитывает разнообразие ресурсов (бонус за наличие разных типов ресурсов)
  - Учитывает доступ к портам (бонус за близость к портам)
-> Ранжирует вершины по оценке.
Предположение: ИИ использует эвристику на основе математического ожидания ресурсов.
Риск: Средний - простая эвристика может быть не оптимальной во всех ситуациях.

[Выбор позиции]: ИИ -> Выбирает вершину с наивысшей оценкой -> Размещает поселение -> Выбирает одно из 3 смежных ребер случайно или с учетом направления к центру поля -> Размещает дорогу.
Предположение: Первое и второе поселения выбираются по одной и той же логике.
Риск: Низкий.
Ключевые слова: [AI-strategy, initial-placement, vertex-evaluation, probability-heuristic] END_LOGIC_BLOCK_AI_INITIAL_PLACEMENT
START_LOGIC_BLOCK_AI_DECISION_MAKING
Назначение: Принятие решений ИИ во время основной фазы игры. Требование: ИИ должен оценивать доступные действия и выбирать оптимальные на основе текущей ситуации. AAG:
[Проверка возможности победы]: ИИ (В начале фазы действий) -> Проверяет, может ли достичь 10 ОП на текущем ходу -> Вычисляет, какие постройки нужны для победы -> Если есть ресурсы для победы, приоритизирует эти действия -> Если нет, переходит к стратегическому планированию.
Предположение: ИИ всегда пытается победить при первой возможности.
Риск: Низкий.

[Приоритеты действий]: ИИ (Если победа недостижима) -> Оценивает действия по приоритетам:
  1. Разыграть карту развития, если она дает немедленное преимущество:
     - Рыцарь: если разбойник блокирует свои гексы или для получения титула "Самая большая армия"
     - Монополия: если нужен конкретный ресурс для важной постройки
     - Строительство дорог: если близок к получению "Самой длинной дороги"
     - Изобретение: если не хватает 1-2 ресурсов для важной постройки
  2. Улучшить поселение до города (если есть ресурсы):
     - Приоритет гексам с высокими вероятностями
  3. Построить новое поселение (если есть ресурсы и доступные позиции):
     - Приоритет позициям с высокой суммарной вероятностью ресурсов
  4. Купить карту развития (если есть ресурсы):
     - Шанс получить рыцаря или карту ОП
  5. Построить дорогу (если нужна для будущего поселения или для "Самой длинной дороги"):
     - Приоритет направлениям к ценным вершинам
  6. Торговать с банком (если нужны ресурсы для вышеперечисленных действий):
     - Использует лучший доступный курс
     - Обменивает наименее ценные ресурсы на наиболее нужные
-> Выполняет действие с наивысшим приоритетом -> Пересматривает приоритеты после каждого действия -> Повторяет до тех пор, пока есть полезные действия.
Предположение: ИИ выполняет несколько действий за ход, если это возможно и выгодно.
Риск: Высокий - сложная логика приоритетов и оценки ситуации.

[Стратегия торговли]: ИИ (При необходимости торговли) -> Определяет целевую постройку (город, поселение, карта развития) -> Вычисляет недостающие ресурсы -> Определяет избыточные ресурсы (которых больше, чем нужно) -> Обменивает избыточные ресурсы на недостающие с использованием лучшего курса -> Если недостает только 1-2 карт и нет избыточных ресурсов, может не торговать.
Предположение: ИИ не делает бесцельные обмены.
Риск: Средний.
Ключевые слова: [AI-decision-making, action-priorities, strategic-planning, resource-management] END_LOGIC_BLOCK_AI_DECISION_MAKING
START_LOGIC_BLOCK_AI_ROBBER_PLACEMENT
Назначение: Стратегия ИИ для размещения разбойника. Требование: ИИ должен выбирать гекс для разбойника, максимально вредя противникам и минимально себе. AAG:
[Оценка гексов для разбойника]: ИИ (При перемещении разбойника) -> Для каждого гекса (кроме текущего с разбойником):
  - Подсчитывает количество смежных поселений/городов противников (не своих)
  - Взвешивает по типу постройки (город весит больше, чем поселение)
  - Учитывает вероятность выпадения числа гекса (более вероятные гексы предпочтительнее)
  - Учитывает количество карт ресурсов у потенциальных жертв (для последующей кражи)
  - Штрафует гексы, смежные с собственными постройками ИИ
-> Ранжирует гексы по оценке.
Предположение: ИИ пытается максимизировать вред противникам и минимизировать вред себе.
Риск: Средний.

[Выбор гекса]: ИИ -> Выбирает гекс с наивысшей оценкой -> Размещает разбойника -> Переходит к выбору жертвы.
Предположение: ИИ всегда выбирает наиболее выгодную позицию по эвристике.
Риск: Низкий.

[Выбор жертвы]: ИИ (После размещения разбойника) -> Находит всех игроков с постройками на гексе -> Фильтрует игроков с 0 карт -> Если несколько жертв доступны, выбирает игрока с наибольшим количеством карт или лидера по ОП -> Крадет случайную карту у выбранной жертвы.
Предположение: ИИ предпочитает красть у сильнейших противников.
Риск: Низкий.
Ключевые слова: [AI-robber-strategy, hex-evaluation, victim-selection, opponent-targeting] END_LOGIC_BLOCK_AI_ROBBER_PLACEMENT
START_LOGIC_BLOCK_AI_CARD_DISCARD
Назначение: Стратегия ИИ для сброса карт при выпадении 7. Требование: ИИ должен выбирать карты для сброса, минимизируя потерю ценных ресурсов. AAG:
[Оценка ценности ресурсов]: ИИ (При необходимости сбросить карты) -> Для каждого типа ресурса оценивает ценность:
  - Высокая ценность: ресурсы, нужные для приоритетных построек (например, руда для города)
  - Средняя ценность: ресурсы, нужные для других построек
  - Низкая ценность: избыточные ресурсы, которых много
-> Ранжирует ресурсы по ценности.
Предположение: ИИ сбрасывает наименее ценные ресурсы.
Риск: Средний.

[Выбор карт для сброса]: ИИ -> Вычисляет количество карт для сброса (floor(количество / 2)) -> Выбирает карты с наименьшей ценностью -> Если несколько карт одного типа, сбрасывает избыточные -> Отправляет выбор системе -> Система удаляет карты из руки ИИ.
Предположение: ИИ пытается сохранить баланс ресурсов.
Риск: Низкий.
Ключевые слова: [AI-discard-strategy, resource-value, card-selection, loss-minimization] END_LOGIC_BLOCK_AI_CARD_DISCARD
END_TZ_SECTION_FR-AI
РАЗДЕЛ 2: ТРЕБОВАНИЯ К ИНТЕРФЕЙСУ ПОЛЬЗОВАТЕЛЯ
BEGIN_TZ_SECTION_UI-SCREENS: Экраны приложения
START_LOGIC_BLOCK_UI_SETUP_SCREEN
Назначение: Экран настройки новой игры. Требование: Игрок должен иметь возможность настроить параметры игры перед стартом. AAG:
[Отображение экрана]: Система (При запуске приложения или выборе "Новая игра") -> Отображает экран с:
  - Заголовком "Catan (Колонизаторы)"
  - Выбором количества игроков (2, 3, 4) - кнопки или выпадающий список, по умолчанию 4
  - Полем ввода имени игрока (по умолчанию "Игрок")
  - Выбором цвета игрока (4 цветные кнопки: красный, синий, белый, оранжевый), по умолчанию красный
  - Информацией: "Противников (ИИ): [N-1]" (автоматически вычисляется)
  - Кнопкой "Начать игру" (основная, выделенная)
  - Кнопкой "Выход" (второстепенная)
  - Опционально: кнопкой "Правила" (открывает текст правил)
Предположение: Экран простой и интуитивный.
Риск: Низкий.

[Валидация ввода]: Система (При нажатии "Начать игру") -> Проверяет, что имя игрока не пустое -> Проверяет, что выбран цвет -> Если валидация не пройдена, показывает сообщение об ошибке -> Если пройдена, переходит к инициализации игры.
Предположение: Цвета компьютерных игроков назначаются автоматически из оставшихся.
Риск: Низкий.

[Запуск игры]: Игрок -> Нажимает "Начать игру" -> Система инициализирует игру (вызывает логические блоки генерации поля, инициализации игроков) -> Переходит к главному экрану игры -> Начинает фазу начальной расстановки.
Предположение: Переход к игре происходит быстро (менее 1 секунды).
Риск: Низкий.
Ключевые слова: [UI, setup-screen, game-configuration, player-input, main-menu] END_LOGIC_BLOCK_UI_SETUP_SCREEN
START_LOGIC_BLOCK_UI_MAIN_GAME_SCREEN
Назначение: Главный экран игры с полем и управлением. Требование: Главный экран должен отображать все необходимые элементы для игры: поле, панели игроков, действия, журнал. AAG:
[Компоновка экрана]: Система (В течение игры) -> Разделяет экран на области:
  - Центральная область: игровое поле (60-70% экрана)
  - Боковые области: панели игроков (по периметру поля или в углах)
  - Нижняя область: панель действий активного игрока
  - Правая или левая область: журнал игры (прокручиваемый список)
-> Обеспечивает, что все элементы видны без прокрутки основного экрана.
Предположение: Компоновка адаптируется под разрешение экрана пользователя.
Риск: Средний - требуется тестирование на разных разрешениях.

[Отображение игрового поля]: Система -> Отрисовывает 19 гексов с текстурами/цветами по типам ресурсов -> Размещает числовые жетоны на гексах (крупный шрифт) -> Отображает разбойника как иконку на текущем гексе -> Отрисовывает порты на краях поля (иконки или текст с курсом) -> Отрисовывает дороги игроков как линии на ребрах (цвет игрока) -> Отрисовывает поселения как малые иконки домов на вершинах (цвет игрока) -> Отрисовывает города как крупные иконки городов на вершинах (цвет игрока) -> Обновляет отображение после каждого действия.
Предположение: Гексы достаточно крупные для четкого отображения всех элементов.
Риск: Средний - требуется баланс между размером элементов и общей видимостью поля.

[Отображение панелей игроков]: Система -> Для каждого игрока отображает панель с:
  - Имя игрока
  - Цветовой индикатор (рамка или фон панели)
  - Ресурсы:
    * Для текущего игрока: детализированный список с иконками и количеством (дерево: 2, глина: 1, и т.д.)
    * Для противников: общее количество карт ресурсов (число)
  - Карты развития:
    * Для текущего игрока: список типов карт или иконки
    * Для противников: общее количество карт развития (число)
  - Победные очки (крупное число)
  - Счетчик разыгранных рыцарей (иконка рыцаря + число)
  - Индикаторы титулов:
    * "Самая длинная дорога" (иконка дороги + длина)
    * "Самая большая армия" (иконка армии + количество)
  - Счетчики доступных фишек (опционально):
    * Дороги: [число]/15
    * Поселения: [число]/5
    * Города: [число]/4
-> Подсвечивает панель активного игрока (яркая рамка или свечение) -> Обновляет после каждого изменения.
Предположение: Панели компактны, но информативны.
Риск: Средний - требуется дизайн для оптимального использования пространства.

[Отображение панели действий]: Система (Для активного игрока-человека) -> Отображает кнопки с иконками и текстом:
  - "Бросить кубики" (доступна в начале хода)
  - "Построить дорогу" (доступна при наличии ресурсов)
  - "Построить поселение" (доступна при наличии ресурсов)
  - "Улучшить до города" (доступна при наличии ресурсов и поселений)
  - "Купить карту развития" (доступна при наличии ресурсов)
  - "Торговать" (всегда доступна)
  - "Разыграть карту" (доступна при наличии карт развития)
  - "Закончить ход" (доступна после броска кубиков)
-> Блокирует недоступные кнопки (серый цвет, курсор "запрещено") -> Показывает всплывающую подсказку при наведении (стоимость постройки, причина недоступности).
Предположение: Кнопки достаточно крупные для удобного клика.
Риск: Низкий.

[Скрытие панели действий для ИИ]: Система (Когда активный игрок — ИИ) -> Скрывает панель действий или показывает сообщение "Ход компьютера..." -> Отображает действия ИИ в реальном времени (анимация, журнал событий).
Предположение: Игрок видит, что делает ИИ, для прозрачности игры.
Риск: Низкий.
Ключевые слова: [UI, main-game-screen, layout, game-board, player-panels, action-buttons] END_LOGIC_BLOCK_UI_MAIN_GAME_SCREEN
START_LOGIC_BLOCK_UI_GAME_LOG
Назначение: Журнал событий игры. Требование: Система должна вести текстовый журнал всех значимых событий игры. AAG:
[Отображение журнала]: Система (Постоянно) -> Отображает прокручиваемую панель/окно -> Добавляет новые записи сверху или снизу (в зависимости от дизайна) -> Каждая запись содержит:
  - Текст события
  - Цветовую кодировку по игрокам (цвет имени игрока соответствует его цвету в игре)
  - Опционально: иконки для типов событий (кубики, постройки, карты)
-> Поддерживает прокрутку для просмотра истории -> Автоматически прокручивается к последнему событию.
Предположение: Журнал видим постоянно, не загораживает игровое поле.
Риск: Низкий.

[Типы событий]:
- "Игрок [Имя] бросил кубики: [число]"
- "Игрок [Имя] получил: [иконки ресурсов]"
- "Выпала 7! Игрок [Имя] сбросил [количество] карт"
- "Игрок [Имя] переместил разбойника на [тип гекса с числом]"
- "Игрок [Имя] украл карту у [Имя]"
- "Игрок [Имя] построил дорогу"
- "Игрок [Имя] построил поселение"
- "Игрок [Имя] улучшил поселение до города"
- "Игрок [Имя] купил карту развития"
- "Игрок [Имя] разыграл [название карты]"
- "Игрок [Имя] обменял [ресурсы] на [ресурсы] (курс [X]:1)"
- "Игрок [Имя] получил титул 'Самая длинная дорога' (длина [число])"
- "Игрок [Имя] получил титул 'Самая большая армия' ([число] рыцарей)"
- "Игрок [Имя] потерял титул 'Самая длинная дорога'"
- "Игрок [Имя] закончил ход"
- "--- Ход [номер] ---" (разделитель)
Предположение: Записи информативны, но лаконичны.
Риск: Низкий.

[Логирование событий]: Система (После каждого игрового события) -> Формирует текст записи -> Добавляет в журнал -> Обновляет отображение.
Предположение: Все значимые события логируются автоматически.
Риск: Низкий.
Ключевые слова: [UI, game-log, event-logging, text-panel, scrollable-list] END_LOGIC_BLOCK_UI_GAME_LOG
START_LOGIC_BLOCK_UI_END_GAME_SCREEN
Назначение: Экран окончания игры с результатами. Требование: При победе игрока система должна отобразить экран с итоговой статистикой. AAG:
[Отображение экрана победы]: Система (Когда игрок достиг 10 ОП) -> Останавливает игровой процесс -> Отображает модальное окно или новый экран с:
  - Заголовком "Победа!" или "Игрок [Имя] победил!"
  - Цветовым выделением победителя
  - Итоговой таблицей результатов всех игроков (отсортированной по ОП):
    Столбцы:
    * Место (1, 2, 3, 4)
    * Имя игрока
    * Цвет игрока (иконка или фон строки)
    * Победные очки (итого)
    * Поселения (количество)
    * Города (количество)
    * Разыгранные рыцари (количество)
    * Длина самой длинной дороги (число)
    * Титулы ("Самая длинная дорога", "Самая большая армия" - галочки или иконки)
    * Карты победных очков (количество или названия)
  - Кнопками:
    * "Новая игра" (возврат к экрану настройки)
    * "Выход" (закрытие приложения)
Предположение: Экран блокирует возврат к игре.
Риск: Низкий.

[Сбор статистики]: Система (Перед отображением экрана) -> Для каждого игрока собирает финальные данные:
  - Подсчитывает количество построенных поселений (5 - доступные фишки)
  - Подсчитывает количество построенных городов (4 - доступные фишки)
  - Получает счетчик разыгранных рыцарей
  - Вычисляет длину самой длинной дороги
  - Проверяет наличие титулов
  - Подсчитывает карты ОП в руке (раскрывает их)
  - Суммирует победные очки
-> Сортирует игроков по убыванию ОП -> Формирует данные для таблицы.
Предположение: Статистика точна и соответствует финальному состоянию игры.
Риск: Низкий.
Ключевые слова: [UI, end-game-screen, victory-screen, final-statistics, results-table] END_LOGIC_BLOCK_UI_END_GAME_SCREEN
END_TZ_SECTION_UI-SCREENS
BEGIN_TZ_SECTION_UI-INTERACTIONS: Взаимодействия пользователя
START_LOGIC_BLOCK_UI_DICE_DISPLAY
Назначение: Отображение результата броска кубиков. Требование: Бросок кубиков должен быть визуально привлекательным и информативным. AAG:
[Отображение кубиков]: Система (После броска) -> Отображает модальное окно или область на экране с:
  - 2 изображениями кубиков с выпавшими гранями (1-6)
  - Суммой выпавших чисел крупным шрифтом (например, "7" красным при выпадении 7)
  - Опционально: краткая анимация "вращения" кубиков (0.5-1 секунда)
-> Кратковременно подсвечивает гексы с выпавшим числом на поле (зеленое свечение или мигание) -> Если выпало 2-6 или 8-12, показывает анимацию "полета" карт ресурсов к панелям получателей -> Закрывает окно/область через 2-3 секунды или по клику игрока.
Предположение: Анимация короткая и не задерживает игровой процесс.
Риск: Низкий.

[Специальное отображение для 7]: Система (Если выпало 7) -> Отображает кубики с красным или желтым фоном -> Показывает сообщение "Разбойник активирован!" -> Не закрывает окно автоматически -> Переходит к обработке выпадения 7 (сброс карт, перемещение разбойника).
Предположение: Игрок четко понимает, что выпало 7 и нужны специальные действия.
Риск: Низкий.
Ключевые слова: [UI, dice-display, dice-roll-animation, visual-feedback, result-presentation] END_LOGIC_BLOCK_UI_DICE_DISPLAY
START_LOGIC_BLOCK_UI_BUILDING_PLACEMENT
Назначение: Интерфейс размещения построек на поле. Требование: Игрок должен иметь визуальную обратную связь при размещении дорог, поселений и городов. AAG:
[Режим размещения дороги]: Система (После выбора "Построить дорогу") -> Меняет курсор на иконку дороги -> Переходит в режим выбора ребра -> Для каждого ребра на поле:
  - Подсвечивает доступные ребра зеленым или подсветкой (смежные с постройками игрока, свободные)
  - Не подсвечивает или подсвечивает красным недоступные ребра
  - При наведении курсора на доступное ребро показывает превью дороги цвета игрока
  - При клике на доступное ребро размещает дорогу (вызывает логический блок)
  - При клике вне доступных ребер или нажатии Esc отменяет режим размещения
-> Выходит из режима после размещения или отмены.
Предположение: Подсветка помогает игроку быстро найти доступные позиции.
Риск: Средний - требуется точная обработка кликов на малых элементах.

[Режим размещения поселения]: Система (После выбора "Построить поселение") -> Меняет курсор на иконку поселения -> Переходит в режим выбора вершины -> Для каждой вершины на поле:
  - Подсвечивает доступные вершины зеленым (смежные с дорогами игрока, соблюдающие правило расстояния, свободные)
  - Не подсвечивает или подсвечивает красным недоступные вершины
  - При наведении на доступную вершину показывает превью поселения цвета игрока
  - При клике на доступную вершину размещает поселение (вызывает логический блок)
  - При клике вне доступных вершин или нажатии Esc отменяет режим размещения
-> Выходит из режима после размещения или отмены.
Предположение: Система визуализирует правило расстояния (затемняет запрещенные вершины в радиусе 2 ребер от существующих поселений).
Риск: Средний.

[Режим улучшения до города]: Система (После выбора "Улучшить до города") -> Меняет курсор на иконку города -> Подсвечивает все поселения игрока на поле (зеленое свечение или рамка) -> При наведении на поселение показывает превью города -> При клике на поселение заменяет его на город (вызывает логический блок) -> При клике вне поселений или нажатии Esc отменяет режим -> Выходит из режима после улучшения или отмены.
Предположение: Игрок может выбрать любое свое поселение.
Риск: Низкий.

[Отображение стоимости]: Система (В режиме строительства) -> Отображает панель или всплывающую подсказку с:
  - Иконками и количеством необходимых ресурсов
  - Подсвечивает красным недостающие ресурсы (если их нет, но режим каким-то образом активирован)
-> Панель видна постоянно в режиме строительства.
Предположение: Стоимость всегда отображается для напоминания.
Риск: Низкий.
Ключевые слова: [UI, building-placement, interactive-mode, visual-highlighting, hover-preview] END_LOGIC_BLOCK_UI_BUILDING_PLACEMENT
START_LOGIC_BLOCK_UI_TRADE_INTERFACE
Назначение: Интерфейс для торговли с банком. Требование: Игрок должен иметь интуитивно понятный интерфейс для выбора ресурсов и курса обмена. AAG:
[Открытие интерфейса]: Игрок (Во время фазы действий) -> Нажимает кнопку "Торговать" -> Система открывает модальное окно "Торговля" -> Отображает:
  - Заголовок "Торговля с банком"
  - Секцию "Мои ресурсы" (текущие ресурсы с иконками и количеством)
  - Секцию "Отдать":
    * Выпадающий список или кнопки для выбора типа ресурса
    * Поле или кнопки +/- для выбора количества (кратное 2, 3 или 4 в зависимости от курса)
  - Секцию "Получить":
    * Выпадающий список или кнопки для выбора типа желаемого ресурса
    * Отображение количества получаемых карт (автоматически вычисляется)
  - Индикатор доступных курсов:
    * "Базовый курс: 4:1"
    * "Общий порт: 3:1" (если доступен, подсвечивается)
    * "Специализированный порт [ресурс]: 2:1" (если доступен, подсвечивается)
  - Кнопки:
    * "Обменять" (активна, если выбор валиден)
    * "Отмена" (закрывает окно)
Предположение: Интерфейс помогает игроку понять, какие курсы доступны.
Риск: Низкий.

[Автоматическое определение курса]: Система (При выборе ресурса для отдачи) -> Проверяет доступ игрока к портам -> Определяет лучший курс для выбранного ресурса -> Отображает активный курс крупным шрифтом или подсветкой -> Вычисляет количество получаемых карт на основе введенного количества отдаваемых карт и курса -> Обновляет отображение в реальном времени.
Предположение: Игрок видит результат обмена до подтверждения.
Риск: Низкий.

[Валидация выбора]: Система (При изменении параметров) -> Проверяет:
  - Наличие достаточного количества отдаваемого ресурса
  - Кратность количества курсу (например, если курс 3:1, количество должно быть кратно 3)
  - Отдаваемый и получаемый ресурсы разные
-> Если валидация не пройдена, блокирует кнопку "Обменять" и показывает подсказку с причиной -> Если пройдена, активирует кнопку.
Предположение: Игрок не может сделать некорректный обмен.
Риск: Низкий.

[Выполнение обмена]: Игрок -> Нажимает "Обменять" -> Система выполняет обмен (вызывает соответствующий логический блок торговли) -> Обновляет отображение ресурсов игрока -> Оставляет окно открытым для следующего обмена или закрывает при нажатии "Отмена".
Предположение: Игрок может совершить несколько обменов подряд без закрытия окна.
Риск: Низкий.
Ключевые слова: [UI, trade-interface, modal-window, resource-selection, rate-display, validation] END_LOGIC_BLOCK_UI_TRADE_INTERFACE
START_LOGIC_BLOCK_UI_DISCARD_CARDS_INTERFACE
Назначение: Интерфейс для сброса карт при выпадении 7. Требование: Игроки с >7 картами должны иметь интерфейс для выбора карт для сброса. AAG:
[Открытие интерфейса]: Система (После выпадения 7 для игроков с >7 картами) -> Для каждого игрока с >7 картами открывает модальное окно "Сброс карт" -> Отображает:
  - Сообщение "У вас больше 7 карт. Сбросьте [количество] карт"
  - Список ресурсов игрока с чекбоксами или кнопками выбора:
    * Дерево: [количество] (кнопки +/- для выбора количества к сбросу)
    * Глина: [количество]
    * Шерсть: [количество]
    * Зерно: [количество]
    * Руда: [количество]
  - Счетчик "Выбрано для сброса: [число] / [требуется]"
  - Кнопку "Подтвердить" (активна, если выбрано точное количество)
Предположение: Игрок должен выбрать ровно floor(количество / 2) карт.
Риск: Средний - интерфейс должен быть интуитивным для быстрого выбора.

[Выбор карт]: Игрок -> Использует кнопки +/- или чекбоксы для выбора карт разных типов -> Система обновляет счетчик "Выбрано для сброса" -> Если выбрано нужное количество, активирует кнопку "Подтвердить" -> Если выбрано больше или меньше, блокирует кнопку и показывает подсказку.
Предположение: Игрок может выбрать любую комбинацию карт.
Риск: Низкий.

[Подтверждение сброса]: Игрок -> Нажимает "Подтвердить" -> Система удаляет выбранные карты из руки игрока (вызывает логический блок сброса карт) -> Закрывает окно -> Переходит к следующему игроку с >7 картами или к перемещению разбойника.
Предположение: Сброс происходит последовательно для каждого игрока (если несколько игроков должны сбросить).
Риск: Низкий.

[Обработка ИИ]: Система (Если игрок, который должен сбросить, — ИИ) -> Автоматически выбирает карты по стратегии ИИ (вызывает логический блок AI_CARD_DISCARD) -> Не показывает интерфейс выбора -> Логирует событие сброса -> Переходит к следующему игроку или разбойнику.
Предположение: Действия ИИ происходят быстро (0.5-1 секунда задержка).
Риск: Низкий.
Ключевые слова: [UI, discard-interface, card-selection, modal-window, seven-rolled] END_LOGIC_BLOCK_UI_DISCARD_CARDS_INTERFACE
START_LOGIC_BLOCK_UI_ROBBER_MOVEMENT_INTERFACE
Назначение: Интерфейс для перемещения разбойника и кражи карты. Требование: Игрок должен иметь интерфейс для выбора гекса для разбойника и жертвы для кражи. AAG:
[Режим перемещения разбойника]: Система (После выпадения 7 или разыгрывания рыцаря) -> Отображает сообщение "Переместите разбойника" -> Меняет курсор на иконку разбойника -> Для каждого гекса на поле:
  - Подсвечивает доступные гексы (все, кроме текущего с разбойником) зеленым или подсветкой
  - Текущий гекс с разбойником затемняет или подсвечивает красным
  - При наведении на доступный гекс показывает превью позиции разбойника
  - При клике на доступный гекс перемещает разбойника (вызывает логический блок) -> Переходит к краже карты
  - При клике на недоступный гекс игнорирует или показывает сообщение об ошибке
Предположение: Игрок обязан переместить разбойника (отмена невозможна).
Риск: Низкий.

[Выбор жертвы]: Система (После перемещения разбойника) -> Находит всех игроков с постройками на новом гексе разбойника -> Фильтрует игроков с 0 карт -> Если жертв нет, пропускает кражу и закрывает режим -> Если жертва одна, автоматически крадет у нее карту -> Если жертв несколько, открывает интерфейс выбора:
  - Модальное окно "Выберите жертву"
  - Список игроков с:
    * Имя и цвет игрока
    * Количество карт ресурсов (число)
    * Кнопка "Украсть" для каждого
-> Игрок выбирает жертву -> Система крадет случайную карту у жертвы (вызывает логический блок) -> Закрывает окно и режим.
Предположение: Игрок видит количество карт у потенциальных жертв, но не типы карт.
Риск: Низкий.

[Обработка ИИ]: Система (Если перемещает разбойника ИИ) -> Автоматически выбирает гекс по стратегии ИИ (вызывает логический блок AI_ROBBER_PLACEMENT) -> Автоматически выбирает жертву -> Не показывает интерфейсы выбора -> Логирует события -> Завершает действие.
Предположение: Действия ИИ происходят с задержкой для наглядности.
Риск: Низкий.
Ключевые слова: [UI, robber-movement, hex-selection, victim-selection, interactive-mode] END_LOGIC_BLOCK_UI_ROBBER_MOVEMENT_INTERFACE
START_LOGIC_BLOCK_UI_DEVELOPMENT_CARD_INTERFACE
Назначение: Интерфейс для просмотра и разыгрывания карт развития. Требование: Игрок должен видеть свои карты развития и иметь возможность разыгрывать их. AAG:
[Отображение карт в панели игрока]: Система (Постоянно для текущего игрока) -> В панели игрока отображает список карт развития:
  - Каждая карта как иконка с названием или тип карты
  - Карты, которые нельзя разыграть (только что купленные), помечает серым цветом или замком
  - Доступные для разыгрывания карты подсвечивает при наведении
  - Показывает всплывающую подсказку при наведении с описанием эффекта карты
  - Карты победных очков показывает отдельно (не разыгрываются, только считаются)
-> Обновляет отображение после покупки или разыгрывания карты.
Предположение: Игрок всегда видит все свои карты развития.
Риск: Низкий.

[Разыгрывание карты через клик]: Игрок -> Кликает на доступную карту развития в своей панели -> Система определяет тип карты -> Вызывает соответствующий интерфейс или логический блок:
  - Рыцарь: переходит в режим перемещения разбойника (UI_ROBBER_MOVEMENT_INTERFACE)
  - Монополия: открывает интерфейс выбора ресурса
  - Строительство дорог: переходит в режим размещения 2 дорог
  - Изобретение: открывает интерфейс выбора 2 ресурсов
  - Карты ОП: не разыгрываются (клик игнорируется или показывается подсказка)
-> После выполнения эффекта удаляет карту из отображения (кроме карт ОП).
Предположение: Каждая карта имеет свой уникальный интерфейс для разыгрывания.
Риск: Низкий.

[Интерфейс выбора ресурса (Монополия)]: Система (При разыгрывании монополии) -> Открывает модальное окно "Монополия" -> Отображает:
  - Сообщение "Выберите ресурс для монополии"
  - 5 кнопок с иконками ресурсов (дерево, глина, шерсть, зерно, руда)
  - Кнопку "Отмена"
-> Игрок выбирает ресурс -> Система выполняет эффект монополии (вызывает логический блок) -> Закрывает окно.
Предположение: Игрок может отменить разыгрывание до выбора ресурса.
Риск: Низкий.

[Интерфейс выбора ресурсов (Изобретение)]: Система (При разыгрывании изобретения) -> Открывает модальное окно "Изобретение" -> Отображает:
  - Сообщение "Выберите 2 ресурса из банка"
  - 2 выпадающих списка или кнопки для выбора первого и второго ресурса
  - Кнопки "Подтвердить" и "Отмена"
-> Игрок выбирает 2 ресурса (могут быть одинаковыми) -> Нажимает "Подтвердить" -> Система выполняет эффект (вызывает логический блок) -> Закрывает окно.
Предположение: Игрок может выбрать любую комбинацию ресурсов.
Риск: Низкий.

[Альтернативный доступ через кнопку]: Игрок -> Нажимает кнопку "Разыграть карту" на панели действий -> Система открывает модальное окно со списком доступных карт развития -> Игрок выбирает карту из списка -> Система вызывает соответствующий интерфейс.
Предположение: Оба способа (клик на карту и кнопка) доступны для удобства.
Риск: Низкий.
Ключевые слова: [UI, development-cards, card-display, play-card, modal-interfaces, resource-selection] END_LOGIC_BLOCK_UI_DEVELOPMENT_CARD_INTERFACE
END_TZ_SECTION_UI-INTERACTIONS
BEGIN_TZ_SECTION_UI-VISUAL-DESIGN: Визуальный дизайн
START_LOGIC_BLOCK_UI_COLOR_SCHEME
Назначение: Определение цветовой схемы приложения. Требование: Игра должна использовать привлекательную и интуитивную цветовую палитру. AAG:
[Цвета ресурсов]: Система -> Использует следующие цвета для типов гексов и карт ресурсов:
  - Лес (дерево): темно-зеленый (#2D5016 или похожий)
  - Поле (зерно): золотисто-желтый (#F4C430 или похожий)
  - Пастбище (шерсть): светло-зеленый/салатовый (#90EE90 или похожий)
  - Горы (руда): темно-серый (#696969 или похожий)
  - Холмы (глина): оранжево-коричневый (#CD853F или похожий)
  - Пустыня: песочный/бежевый (#F5DEB3 или похожий)
-> Применяет цвета для фона гексов, иконок ресурсов в интерфейсе и карт.
Предположение: Цвета соответствуют интуитивным ассоциациям.
Риск: Низкий.

[Цвета игроков]: Система -> Использует 4 контрастных цвета для игроков:
  - Красный (#DC143C или похожий)
  - Синий (#1E90FF или похожий)
  - Белый (#FFFFFF с темной обводкой для видимости)
  - Оранжевый (#FF8C00 или похожий)
-> Применяет цвета для дорог, поселений, городов, панелей игроков и текста в журнале.
Предположение: Цвета хорошо различимы на фоне игрового поля.
Риск: Низкий.

[Общая цветовая схема интерфейса]: Система -> Использует:
  - Фон основного экрана: нейтральный (светло-серый, бежевый или текстура дерева/камня для тематики)
  - Фон панелей: полупрозрачный темный или светлый с рамками
  - Цвет кнопок:
    * Активные: яркий акцентный цвет (например, зеленый для подтверждения, синий для действий)
    * Неактивные: серый (#A9A9A9)
    * Опасные действия (отмена, выход): красный или оранжевый
  - Текст: контрастный к фону (черный на светлом, белый на темном)
  - Подсветка выбора: зеленый или желтый (полупрозрачный)
-> Обеспечивает высокий контраст для читаемости.
Предположение: Дизайн тематически соответствует настольной игре (средневековая/колониальная эстетика).
Риск: Средний - требуется баланс между красотой и функциональностью.
Ключевые слова: [UI, color-scheme, resource-colors, player-colors, theme, visual-identity] END_LOGIC_BLOCK_UI_COLOR_SCHEME
START_LOGIC_BLOCK_UI_ICONS_AND_GRAPHICS
Назначение: Определение иконок и графических элементов. Требование: Игра должна использовать четкие и узнаваемые иконки для всех элементов. AAG:
[Иконки ресурсов]: Система -> Использует иконки для каждого ресурса:
  - Дерево: иконка дерева или бревна
  - Глина: иконка кирпича или глиняного блока
  - Шерсть: иконка овцы или клубка шерсти
  - Зерно: иконка колоса пшеницы или снопа
  - Руда: иконка железного слитка или кристалла
-> Иконки размером 32x32 или 64x64 пикселя (векторные для масштабирования) -> Применяет в панелях игроков, интерфейсах торговли, подсказках стоимости.
Предположение: Иконки стилистически едины (один художественный стиль).
Риск: Средний - требуется дизайн или поиск готовых иконок.

[Иконки построек]: Система -> Использует иконки для построек:
  - Дорога: простая линия или изображение дороги
  - Поселение: малый домик (одноэтажный)
  - Город: крупное здание с башнями или несколько домов
-> Иконки масштабируются в зависимости от контекста (на поле крупнее, в интерфейсе меньше) -> Цвет иконки соответствует цвету игрока.
Предположение: Иконки четко различимы на игровом поле.
Риск: Средний.

[Иконки карт развития]: Система -> Использует иконки для типов карт:
  - Рыцарь: изображение рыцаря/меча/щита
  - Монополия: изображение монет или сундука
  - Строительство дорог: изображение 2 дорог или инструментов
  - Изобретение: изображение свитка или колбы
  - Карты ОП (общая иконка или уникальные для каждой):
    * Университет: здание университета
    * Библиотека: книги
    * Рыночная площадь: рынок/палатки
    * Большой зал: дворец
    * Часовня: религиозное здание
-> Иконки применяются в панелях игроков, интерфейсах разыгрывания.
Предположение: Игрок быстро распознает тип карты по иконке.
Риск: Средний.

[Иконки действий]: Система -> Использует иконки для кнопок действий:
  - Бросить кубики: 2 кубика
  - Торговать: стрелки обмена или монеты
  - Закончить ход: галочка или стрелка вправо
-> Иконки сопровождаются текстом для ясности.
Предположение: Иконки интуитивны и ускоряют навигацию.
Риск: Низкий.

[Текстуры гексов]: Система -> Использует текстуры или паттерны для гексов:
  - Лес: текстура деревьев
  - Поле: текстура пшеницы или травы
  - Пастбище: текстура травы с овцами (опционально)
  - Горы: текстура камней
  - Холмы: текстура холмистой местности
  - Пустыня: текстура песка
-> Текстуры не перегружают визуал, сохраняя читаемость числовых жетонов.
Предположение: Текстуры могут быть упрощенными паттернами, а не фотореалистичными.
Риск: Средний - требуется баланс детализации.

[Иконка разбойника]: Система -> Использует узнаваемую иконку разбойника (фигура в плаще, маска, или стилизованный персонаж) -> Иконка контрастна к фону гексов -> Размер достаточен для видимости, но не загораживает числовой жетон.
Предположение: Разбойник четко виден на любом гексе.
Риск: Низкий.
Ключевые слова: [UI, icons, graphics, textures, visual-elements, resource-icons, building-icons] END_LOGIC_BLOCK_UI_ICONS_AND_GRAPHICS
START_LOGIC_BLOCK_UI_TYPOGRAPHY
Назначение: Определение типографики интерфейса. Требование: Игра должна использовать читаемые шрифты для всех текстовых элементов. AAG:
[Выбор шрифтов]: Система -> Использует шрифты:
  - Заголовки (названия окон, экраны): крупный, жирный sans-serif или тематический шрифт (например, с засечками в средневековом стиле), размер 24-32pt
  - Основной текст (описания, журнал игры): читаемый sans-serif (например, Arial, Roboto, Open Sans), размер 14-16pt
  - Числовые значения (победные очки, ресурсы, числа на гексах): крупный, жирный, размер 18-24pt для важных чисел, 12-14pt для счетчиков
  - Кнопки: средний, жирный, размер 14-18pt
-> Обеспечивает поддержку кириллицы (для русских имен игроков и локализации).
Предположение: Шрифты хорошо читаются на разных фонах.
Риск: Низкий.

[Иерархия текста]: Система -> Устанавливает визуальную иерархию:
  - Наиболее важная информация (победные очки, текущий ход): крупный размер, яркий цвет
  - Второстепенная информация (счетчики ресурсов): средний размер
  - Детали (подсказки, журнал): меньший размер
-> Использует жирность и цвет для акцентов.
Предположение: Игрок быстро находит нужную информацию.
Риск: Низкий.

[Контраст и читаемость]: Система -> Обеспечивает высокий контраст текста и фона:
  - Светлый текст на темном фоне или темный текст на светлом фоне
  - Избегает низкоконтрастных комбинаций (например, серый на сером)
  - Для текста на текстурах использует обводку или полупрозрачный фон
-> Тестирует читаемость на разных разрешениях экрана.
Предположение: Текст читаем при любом размере окна.
Риск: Средний.
Ключевые слова: [UI, typography, fonts, readability, text-hierarchy, contrast] END_LOGIC_BLOCK_UI_TYPOGRAPHY
START_LOGIC_BLOCK_UI_ANIMATIONS
Назначение: Определение анимаций и визуальных эффектов. Требование: Игра должна использовать минималистичные анимации для улучшения UX без замедления игрового процесса. AAG:
[Анимация броска кубиков]: Система (При броске кубиков) -> Отображает короткую анимацию "вращения" кубиков (0.5-1 секунда) -> Кубики останавливаются на выпавших гранях -> Опционально: звуковой эффект броска кубиков.
Предположение: Анимация добавляет атмосферности, но не раздражает при многократном просмотре.
Риск: Низкий.

[Анимация распределения ресурсов]: Система (После броска 2-6, 8-12) -> Отображает анимацию "полета" карт ресурсов от активных гексов к панелям игроков (1-2 секунды) -> Карты "приземляются" в счетчики ресурсов -> Опционально: звук получения ресурса.
Предположение: Анимация помогает игрокам понять, кто получил ресурсы.
Риск: Низкий.

[Плавные переходы модальных окон]: Система (При открытии/закрытии окон) -> Использует плавное появление/исчезновение (fade in/out, 0.2-0.3 секунды) -> Окна не "прыгают" на экран.
Предположение: Плавные переходы улучшают восприятие интерфейса.
Риск: Низкий.

[Подсветка интерактивных элементов]: Система (При наведении курсора) -> Подсвечивает кнопки, ребра, вершины, гексы при наведении (изменение цвета, свечение, масштабирование на 5-10%) -> Изменение происходит мгновенно или с минимальной задержкой (0.1 секунда).
Предположение: Подсветка помогает игроку понять, на что можно кликнуть.
Риск: Низкий.

[Анимация размещения построек]: Система (При размещении дороги/поселения/города) -> Постройка появляется с легкой анимацией (масштабирование от 0 до 100%, 0.3 секунды) -> Опционально: звук строительства.
Предположение: Анимация делает действие более заметным.
Риск: Низкий.

[Анимация перемещения разбойника]: Система (При перемещении разбойника) -> Разбойник "перемещается" с текущего гекса на новый с плавной анимацией (скольжение или телепортация, 0.5 секунды) -> Опционально: звук перемещения.
Предположение: Анимация показывает изменение позиции разбойника.
Риск: Низкий.

[Отключение анимаций (опционально для будущих версий)]: Система -> Предоставляет опцию в настройках для отключения всех анимаций (для ускорения игры или для игроков, предпочитающих минимализм).
Предположение: Не реализуется в MVP, но учитывается в дизайне.
Риск: Низкий.
Ключевые слова: [UI, animations, visual-effects, transitions, hover-effects, user-feedback] END_LOGIC_BLOCK_UI_ANIMATIONS
START_LOGIC_BLOCK_UI_RESPONSIVE_DESIGN
Назначение: Адаптивность интерфейса под разные разрешения экрана. Требование: Игра должна корректно отображаться на разных размерах экрана пользователя. AAG:
[Минимальное разрешение]: Система -> Определяет минимальное поддерживаемое разрешение (например, 1280x720) -> При меньшем разрешении показывает предупреждение или добавляет прокрутку.
Предположение: Большинство современных компьютеров поддерживают минимум 1280x720.
Риск: Низкий.

[Масштабирование элементов]: Система -> При изменении размера окна масштабирует:
  - Игровое поле (гексы, постройки) пропорционально
  - Панели игроков сохраняют читаемость (минимальный размер текста)
  - Кнопки остаются кликабельными (минимальный размер 40x40 пикселей)
-> Использует относительные единицы (проценты, em, rem) для размеров элементов.
Предположение: Интерфейс адаптируется без потери функциональности.
Риск: Средний - требуется тестирование на разных разрешениях.

[Компоновка для широких экранов]: Система (Для разрешений >1920x1080) -> Использует дополнительное пространство для:
  - Увеличения размера игрового поля
  - Размещения журнала игры и панелей игроков по бокам (вместо углов)
-> Не растягивает элементы до неестественных размеров.
Предположение: Широкоэкранные мониторы обеспечивают лучший обзор.
Риск: Низкий.

[Компоновка для узких экранов]: Система (Для разрешений близких к минимальному) -> Компактно размещает панели игроков (возможно, перекрывающиеся или всплывающие по клику) -> Уменьшает размер иконок и отступы -> Обеспечивает видимость игрового поля как приоритет.
Предположение: На минимальном разрешении игра остается играбельной, но менее комфортной.
Риск: Средний.

[Полноэкранный режим]: Система -> Предоставляет опцию полноэкранного режима (F11 или кнопка) -> В полноэкранном режиме максимизирует использование пространства экрана.
Предположение: Полноэкранный режим улучшает погружение.
Риск: Низкий.
Ключевые слова: [UI, responsive-design, screen-resolution, scaling, adaptive-layout] END_LOGIC_BLOCK_UI_RESPONSIVE_DESIGN
END_TZ_SECTION_UI-VISUAL-DESIGN
РАЗДЕЛ 3: ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ И ОГРАНИЧЕНИЯ
BEGIN_TZ_SECTION_TECH: Технические требования
START_LOGIC_BLOCK_TECH_PLATFORM
Назначение: Определение целевой платформы и окружения. Требование: Игра должна работать на локальном компьютере пользователя (macOS). AAG:
[Целевая платформа]: Игра разрабатывается для запуска на macOS (Darwin 24.5.0) на локальном компьютере.
Предположение: Используются веб-технологии (запуск в браузере) или кроссплатформенный фреймворк.
Риск: Низкий.

[Окружение запуска]: Возможные варианты (выбор будет сделан на этапе архитектуры):
  - Веб-приложение (запуск в браузере: Chrome, Safari, Firefox)
  - Десктопное приложение (Electron, Tauri)
  - Нативное приложение (Swift для macOS) - менее вероятно
Предположение: Веб-технологии предпочтительны для быстрой разработки и согласованности с методологией.
Риск: Низкий.

[Требования к системе]: Минимальные требования:
  - Процессор: любой современный (последние 5 лет)
  - ОЗУ: 4 ГБ (для браузера/приложения)
  - Свободное место: минимальное (50-100 МБ для ресурсов игры)
  - Разрешение экрана: минимум 1280x720
Предположение: Игра не требует мощного железа.
Риск: Низкий.
Ключевые слова: [platform, macOS, web-app, desktop-app, system-requirements] END_LOGIC_BLOCK_TECH_PLATFORM
START_LOGIC_BLOCK_TECH_SEMANTIC_MARKUP
Назначение: Требования к семантической разметке кода. Требование: Весь код должен быть аннотирован согласно семантическому шаблону разметки для использования ИИ-агентами. AAG:
[Применение шаблона]: Каждый файл кода (компонент, функция, хук) должен содержать:
  - Заголовочный комментарий с метаданными файла (описание, зависимости, ключевые слова)
  - Контракты для компонентов (PURPOSE, PROPS, STATE, OUTPUTS, SIDE_EFFECTS, KEYWORDS)
  - Контракты для функций (PURPOSE, INPUTS, OUTPUTS, SIDE_EFFECTS, KEYWORDS)
  - Контракты для хуков (PURPOSE, INPUTS, RETURNS, SIDE_EFFECTS, DEPENDENCIES, KEYWORDS)
  - Аннотации логических блоков внутри функций (START_BLOCK_... / END_BLOCK_...)
Предположение: Разметка выполняется в формате JSDoc-комментариев для TypeScript/TSX.
Риск: Средний - требуется строгое соблюдение шаблона при генерации кода.

[Связь с ТЗ]: Контракты кода должны ссылаться на логические блоки ТЗ:
  - В секции RELATED_REQUIREMENTS или IMPLEMENTS указывать идентификаторы блоков ТЗ (например, START_LOGIC_BLOCK_DICE_ROLL)
Предположение: Трассируемость между ТЗ и кодом облегчает навигацию для ИИ-агентов.
Риск: Низкий.

[Уровень детализации]: Аннотации должны быть достаточно детальными для:
  - Понимания назначения кода без чтения реализации
  - Навигации по связям между компонентами
  - Модификации кода ИИ-агентами без нарушения логики
Предположение: Излишняя детализация может загромоздить код, требуется баланс.
Риск: Средний.
Ключевые слова: [semantic-markup, code-annotation, JSDoc, AI-agent-compatibility, traceability] END_LOGIC_BLOCK_TECH_SEMANTIC_MARKUP
START_LOGIC_BLOCK_TECH_PERFORMANCE
Назначение: Требования к производительности приложения. Требование: Игра должна работать плавно (60 FPS) на современных компьютерах. AAG:
[Целевая частота кадров]: Интерфейс должен поддерживать 60 FPS (обновление экрана каждые ~16 мс) для плавной анимации и отклика на действия пользователя.
Предположение: Базовая игра с 2D графикой не требует интенсивных вычислений.
Риск: Низкий.

[Оптимизация вычислений]: Сложные алгоритмы (поиск длиннейшего пути, валидация позиций) должны выполняться за приемлемое время:
  - Поиск длиннейшего пути: <100 мс
  - Валидация размещения постройки: <50 мс
  - Генерация поля: <200 мс
  - Ход ИИ (полный цикл): <2 секунды (включая искусственные задержки)
Предположение: Оптимизация структур данных (графы, хэш-таблицы) обеспечивает быстродействие.
Риск: Средний - алгоритм поиска длиннейшего пути потенциально сложен.

[Оптимизация рендеринга]: Визуальные элементы должны перерисовываться только при изменении состояния (избегать избыточных ре-рендеров в React).
Предположение: Использование мемоизации (React.memo, useMemo, useCallback) для оптимизации.
Риск: Средний - требуется правильная архитектура состояния.

[Потребление памяти]: Игра не должна потреблять избыточную память (целевое потребление <200 МБ ОЗУ для всего приложения).
Предположение: Базовая игра с ограниченным количеством элементов (19 гексов, 54 вершины, 72 ребра, 4 игрока) не требует большого объема памяти.
Риск: Низкий.
Ключевые слова: [performance, 60fps, optimization, algorithm-complexity, memory-usage] END_LOGIC_BLOCK_TECH_PERFORMANCE
START_LOGIC_BLOCK_TECH_DATA_STRUCTURES
Назначение: Определение ключевых структур данных. Требование: Игра должна использовать эффективные структуры данных для хранения состояния игры. AAG:
[Структура игрового поля]: Граф, состоящий из:
  - Массив гексов (19 элементов), каждый гекс содержит:
    * id: уникальный идентификатор
    * type: тип ресурса (wood, brick, wool, grain, ore, desert)
    * number: числовой жетон (2-12 или null для пустыни)
    * robber: boolean (находится ли разбойник на этом гексе)
    * adjacentVertices: массив id смежных вершин (6 элементов)
    * adjacentEdges: массив id смежных ребер (6 элементов)
    * coordinates: координаты для рендеринга (x, y)
  - Массив вершин (54 элемента), каждая вершина содержит:
    * id: уникальный идентификатор
    * building: null | {type: 'settlement' | 'city', playerId: string}
    * adjacentHexes: массив id смежных гексов (1-3 элемента)
    * adjacentEdges: массив id смежных ребер (2-3 элемента)
    * adjacentVertices: массив id смежных вершин (2-3 элемента)
    * port: null | {type: 'general' | 'wood' | 'brick' | 'wool' | 'grain' | 'ore', ratio: 3 | 2}
    * coordinates: координаты для рендеринга (x, y)
  - Массив ребер (72 элемента), каждое ребро содержит:
    * id: уникальный идентификатор
    * road: null | {playerId: string}
    * adjacentVertices: массив id 2 смежных вершин
    * adjacentHexes: массив id смежных гексов (1-2 элемента)
    * adjacentEdges: массив id смежных ребер (2-4 элемента)
    * coordinates: координаты для рендеринга (x1, y1, x2, y2)
Предположение: Графовая структура обеспечивает быстрый доступ к связям между элементами.
Риск: Средний - построение графа требует аккуратности.

[Структура игрока]: Объект игрока содержит:
  - id: уникальный идентификатор
  - name: имя игрока
  - color: цвет игрока
  - isAI: boolean (человек или ИИ)
  - resources: объект {wood: number, brick: number, wool: number, grain: number, ore: number}
  - developmentCards: массив объектов {type: 'knight' | 'monopoly' | 'road_building' | 'year_of_plenty' | 'victory_point', subtype: string (для карт ОП), playedThisTurn: boolean}
  - knightsPlayed: number
  - longestRoadLength: number
  - victoryPoints: number
  - availablePieces: объект {roads: number, settlements: number, cities: number}
  - ports: массив {type: string, ratio: number} (доступные порты)
  - hasLongestRoad: boolean
  - hasLargestArmy: boolean
Предположение: Структура обеспечивает быстрый доступ к данным игрока.
Риск: Низкий.

[Структура состояния игры]: Объект состояния содержит:
  - board: объект с массивами hexes, vertices, edges
  - players: массив игроков
  - currentPlayerIndex: number (индекс активного игрока в массиве)
  - turnPhase: 'initial_placement_1' | 'initial_placement_2' | 'roll_dice' | 'action_phase' | 'game_over'
  - diceRoll: null | {dice1: number, dice2: number, sum: number}
  - developmentDeck: массив карт развития (не купленных)
  - longestRoadHolder: null | playerId
  - largestArmyHolder: null | playerId
  - winner: null | playerId
  - gameLog: массив строк событий
Предположение: Централизованное состояние упрощает управление игрой.
Риск: Низкий.
Ключевые слова: [data-structures, game-state, graph, player-object, board-structure] END_LOGIC_BLOCK_TECH_DATA_STRUCTURES
END_TZ_SECTION_TECH
РАЗДЕЛ 4: ГРАНИЦЫ MVP
BEGIN_TZ_SECTION_MVP: Границы минимально жизнеспособного продукта
START_LOGIC_BLOCK_MVP_INCLUDED
Назначение: Определение функционала, включенного в MVP. Требование: MVP должен включать все базовые функции для полноценной игры против компьютера. AAG:
[Включено в MVP]:
1. Генерация стандартного игрового поля (19 гексов, числовые жетоны, порты, графовая структура)
2. Инициализация 2-4 игроков (1 человек + 1-3 ИИ) с выбором цвета и имени
3. Начальная расстановка (2 раунда: прямой и обратный порядок)
4. Полный игровой цикл:
   - Бросок кубиков
   - Распределение ресурсов
   - Активация разбойника при 7
   - Фаза действий (строительство, торговля, карты развития)
   - Завершение хода
5. Строительство:
   - Дороги (1 дерево + 1 глина)
   - Поселения (1 дерево + 1 глина + 1 шерсть + 1 зерно)
   - Города (3 руды + 2 зерна)
6. Разбойник:
   - Перемещение при 7 и через рыцаря
   - Сброс карт (при >7 картах)
   - Кража карты у соседнего игрока
7. Торговля с банком:
   - Базовый курс 4:1
   - Общий порт 3:1
   - Специализированные порты 2:1
8. Карты развития:
   - Колода из 25 карт (14 рыцарей, 2 монополии, 2 строительства дорог, 2 изобретения, 5 карт ОП)
   - Покупка карты (1 шерсть + 1 зерно + 1 руда)
   - Разыгрывание всех типов карт
9. Достижения:
   - Самая длинная дорога (≥5, +2 ОП)
   - Самая большая армия (≥3 рыцарей, +2 ОП)
10. Условие победы (10 победных очков)
11. Базовый ИИ противника (один уровень сложности) с:
    - Стратегией начальной расстановки
    - Приоритизацией действий
    - Размещением разбойника
    - Сбросом карт
12. Визуально привлекательный UI:
    - Главный экран с игровым полем
    - Панели игроков
    - Панель действий
    - Модальные окна для торговли, карт развития, разбойника
    - Экран настройки игры
    - Экран окончания игры
13. Журнал игры (текстовый лог всех событий)
14. Валидация всех действий по правилам игры
15. Красивый визуальный дизайн (цвета, иконки, текстуры гексов)

Предположение: MVP достаточен для полноценной игры против компьютера и демонстрации всех основных механик Catan.
Риск: Средний - объем MVP значителен, требуется приоритизация при разработке.
Ключевые слова: [MVP, included-features, scope, base-functionality, core-game] END_LOGIC_BLOCK_MVP_INCLUDED
START_LOGIC_BLOCK_MVP_EXCLUDED
Назначение: Определение функционала, исключенного из MVP (для будущих версий). Требование: Четко обозначить границы MVP, исключив второстепенные функции. AAG:
[Исключено из MVP] (для версий 2.0+):
1. Торговля между игроками (обмен ресурсами человек↔человек, человек↔ИИ, ИИ↔ИИ)
2. Мультиплеер:
   - Игра по сети (несколько людей через интернет)
   - "Hot-seat" режим (несколько людей на одном компьютере по очереди)
3. Сохранение и загрузка игр:
   - Сохранение текущего состояния игры
   - Загрузка сохраненной игры
   - Автосохранение
4. Авторизация и профили пользователей:
   - Регистрация/вход через email или соцсети
   - Хранение профиля игрока
5. Статистика игрока:
   - Количество побед/поражений
   - Средний счет
   - Любимая стратегия
   - История игр
6. Настройки игры:
   - Звуковые эффекты (вкл/выкл, громкость)
   - Музыка (вкл/выкл, выбор треков)
   - Отключение анимаций
   - Скорость игры ИИ
   - Язык интерфейса (локализация)
7. Несколько уровней сложности ИИ:
   - Легкий (случайные действия)
   - Средний (базовая эвристика, реализована в MVP)
   - Сложный (продвинутая стратегия, долгосрочное планирование)
   - Эксперт (с элементами машинного обучения)
8. Расширения игры:
   - Игра на 5-6 игроков (расширенное поле)
   - Дополнительные карты развития
   - Варианты правил (например, "Города и рыцари", "Мореплаватели")
9. Случайная генерация поля:
   - Генерация случайной конфигурации гексов (вместо стандартной)
   - Настройка баланса генерации
10. Продвинутые анимации:
    - 3D вид поля
    - Анимация действий ИИ (движущиеся фишки)
    - Детальная анимация броска кубиков (физика)
11. Обучение/Туториал:
    - Интерактивное обучение правилам для новых игроков
    - Подсказки во время игры
12. Система достижений:
    - Бейджи за выполнение условий (например, "Построил 10 городов")
    - Прогресс по достижениям
13. Просмотр истории ходов:
    - Возможность "перемотать" игру назад для анализа
    - Экспорт игры в формат для просмотра
14. Кастомизация:
    - Выбор скинов для построек
    - Выбор тем оформления (светлая/темная)
    - Выбор набора иконок

Предположение: Исключенные функции могут быть добавлены в будущих версиях на основе обратной связи пользователей.
Риск: Низкий - четкие границы MVP помогают фокусироваться на ключевом функционале.
Ключевые слова: [MVP, excluded-features, future-versions, out-of-scope, v2.0] END_LOGIC_BLOCK_MVP_EXCLUDED
END_TZ_SECTION_MVP
ЗАКЛЮЧЕНИЕ
Данное техническое задание описывает полный функционал игры Catan (Колонизаторы) для игры против компьютера с детальной декомпозицией на логические блоки. Каждый блок (START_LOGIC_BLOCK_... / END_LOGIC_BLOCK_...) может быть использован в качестве референса при создании контрактов функций и компонентов на этапе разработки.
Ключевые характеристики ТЗ:
Детальная декомпозиция: Функционал разбит на 50+ логических блоков
Трассируемость: Каждый блок имеет уникальный идентификатор для ссылок
AAG-нотация: Использованы сценарии Актор-Действие-Результат с предположениями и рисками
Семантическая разметка: Структура ТЗ готова для использования ИИ-агентами
Четкие границы MVP: Определено, что включено и исключено из первой версии
Следующие этапы (НЕ ЧАСТЬ ДАННОГО ТЗ):
Проектирование архитектуры приложения
Выбор технологического стека
Проектирование компонентной структуры
Генерация кода с семантической разметкой
КОНЕЦ ТЕХНИЧЕСКОГО ЗАДАНИЯ